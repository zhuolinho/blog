window.__require=function e(t,o,a){function n(r,l){if(!o[r]){if(!t[r]){var s=r.split("/");if(s=s[s.length-1],!t[s]){var c="function"==typeof __require&&__require;if(!l&&c)return c(s,!0);if(i)return i(s,!0);throw new Error("Cannot find module '"+r+"'")}}var u=o[r]={exports:{}};t[r][0].call(u.exports,function(e){return n(t[r][1][e]||e)},u,u.exports,e,t,o,a)}return o[r].exports}for(var i="function"==typeof __require&&__require,r=0;r<a.length;r++)n(a[r]);return n}({AudioController:[function(e,t,o){"use strict";cc._RF.push(t,"c3611jDu5hL7auVf9iIBCz5","AudioController"),Object.defineProperty(o,"__esModule",{value:!0});var a=e("../Utils/HashMap"),n=e("./EventManager"),i=e("./EventName"),r=function(){function e(){this.audioID={},this.clips=new a.HashMap}return Object.defineProperty(e,"inst",{get:function(){return this.ins?this.ins:this.ins=new e},enumerable:!0,configurable:!0}),e.prototype.init=function(e){console.warn(" start load AudioClip ");var t=this;cc.loader.loadResDir("preloadSounds",cc.AudioClip,function(o,a,n){if(o)console.error(o);else{for(var i=0,r=a;i<r.length;i++){var l=r[i];"string"==typeof l._audio&&(l._audio=cc.loader._cache[l._audio].buffer),t.clips.add(l.name,l)}t.initEvent(),e&&e()}})},e.prototype.initEvent=function(){var e=this;n.gEventMgr.targetOff(this),this.audioID.bgm=this.play("bgm",!0,1.5,!0),n.gEventMgr.on(i.GlobalEvent.SMALL_BGM,function(){null!=e.audioID.bgm&&cc.audioEngine.setVolume(e.audioID.bgm,.5)},this),n.gEventMgr.on(i.GlobalEvent.NORMAL_BGM,function(){null!=e.audioID.bgm&&cc.audioEngine.setVolume(e.audioID.bgm,1)},this),n.gEventMgr.on(i.GlobalEvent.CHANGE_BGM,function(t){null!=e.audioID.bgm&&(e.stop(e.audioID.bgm,"bgm"),e.audioID.bgm=e.play(t,!0,1,!0))},this),n.gEventMgr.on(i.GlobalEvent.PLAY_EFFECT,function(t,o){void 0===o&&(o=1),e.audioID[t]=e.play(t,!1,o)},this)},e.prototype.stop=function(t,o){if(e.canPlay)cc.audioEngine.stop(t);else for(var a=0,n=e.PlayedList;a<n.length;a++){var i=n[a];i.skip=i.clipName==o}},e.prototype.play=function(t,o,a,n,i){var r=this;if(void 0===o&&(o=!1),void 0===a&&(a=1),void 0===n&&(n=!1),void 0===i&&(i=0),!e.canPlay&&!e.hasBindTouch){e.hasBindTouch=!0;var l=this,s=function(){var t;for(cc.game.canvas.removeEventListener("touchstart",s),e.canPlay=!0;(t=e.PlayedList.pop())&&l.clips.get(t.clipName)&&!t.skip;){var o=cc.audioEngine.play(l.clips.get(t.clipName),t.loop,t.volume);t.isBgm?(l.audioID.bgm=o,cc.audioEngine.setCurrentTime(o,(Date.now()-t.supTime)/1e3%cc.audioEngine.getDuration(o))):cc.audioEngine.setCurrentTime(o,(Date.now()-t.supTime)/1e3)}};cc.game.canvas.addEventListener("touchstart",s)}if(!this.clips.get(t)){var c=Date.now();return cc.loader.loadRes("sounds/"+t,cc.AudioClip,function(e,i){if(e)console.error(e);else{"string"==typeof i._audio&&(i._audio=cc.loader._cache[i._audio].buffer),r.clips.add(i.name,i);var l=(Date.now()-c)/1e3;r.audioID[t]=r.play(t,o,a,n,l)}}),-1}if(e.canPlay){var u=cc.audioEngine.play(this.clips.get(t),o,a);return cc.audioEngine.setCurrentTime(u,i%cc.audioEngine.getDuration(u)),u}for(var h=!1,p=0,d=e.PlayedList;p<d.length;p++){if(d[p].clipName==t){h=!0;break}}return h?-2:(e.PlayedList.push({clipName:t,loop:o,volume:a,supTime:Date.now()-i/1e3,skip:!1,isBgm:n}),-2)},e.PlayedList=[],e.canPlay=cc.sys.os.toLowerCase()!=cc.sys.OS_IOS.toLowerCase(),e.hasBindTouch=!1,e}();o.gAudio=r.inst,cc._RF.pop()},{"../Utils/HashMap":"HashMap","./EventManager":"EventManager","./EventName":"EventName"}],BubbleMatrix:[function(e,t,o){"use strict";cc._RF.push(t,"3fc87k3ArdNNIwVYgSiAJGh","BubbleMatrix"),Object.defineProperty(o,"__esModule",{value:!0});var a=e("../Const"),n=e("../Controller/Game");o.MatrixSize=14,o.UseSize=10;var i;(function(e){e[e.Normal=0]="Normal",e[e.Double=1]="Double",e[e.Boom=2]="Boom",e[e.Magic=3]="Magic",e[e.Horce=4]="Horce"})(i=o.SpecialType||(o.SpecialType={}));var r=function(){function e(){this.matrixData=[],this.addRowTotalCount=0,this.firstRow=0;for(var e=0;e<o.MatrixSize*o.MatrixSize;e++)this.matrixData[e]={color:a.BubbleType.Blank,bubble:null,type:i.Normal}}return Object.defineProperty(e.prototype,"data",{get:function(){return this.matrixData},enumerable:!0,configurable:!0}),e.prototype.addRow=function(e){var t=this.matrixData.length;this.matrixData.length+=e*o.MatrixSize;for(var n=t;n<this.matrixData.length;n++)this.matrixData[n]={color:a.BubbleType.Blank,bubble:null,type:i.Normal}},e.prototype.getRestRowCount=function(){return this.addRowTotalCount},e.prototype.getFirstRow=function(){return this.firstRow},e.prototype.moveRow=function(e){if(this.addRowTotalCount<=e){this.addRow(6),this.firstRow+=5,n.Game.startIndex+=5*o.MatrixSize,this.addRowTotalCount+=6;var t=6*o.MatrixSize;console.log(" \u65b0\u589e6\u884c\uff1a ",t);for(var r=this.matrixData.length-1;r>=t;r--)this.matrixData[r-t]||(this.matrixData[r-t]={color:a.BubbleType.Blank,bubble:null,type:i.Normal}),this.matrixData[r].color=this.matrixData[r-t].color,this.matrixData[r].type=this.matrixData[r-t].type,this.matrixData[r].bubble=this.matrixData[r-t].bubble,this.matrixData[r-t]={color:a.BubbleType.Blank,bubble:null,type:i.Normal},this.matrixData[r].bubble&&this.matrixData[r].bubble.setIndex(r);var l=Math.ceil(CMath.getRandom(a.DoubleBubbleRange.Min,a.DoubleBubbleRange.Max)),s=Math.ceil(CMath.getRandom(a.BoomBubbleRange.Min,a.BoomBubbleRange.Max)),c=Math.ceil(CMath.getRandom(a.MagicBubbleRange.Min,a.MagicBubbleRange.Max));console.log(" double:",l,", boom:",s,", magic:",c);var u=[];for(r=0;r<=t-1;r++)this.index2j(r)>=2&&this.index2j(r)<=11&&u.push(r);for(var h=a.BubbleColors.concat(),p={};l>0&&h.length>0&&u.length>=0;){var d=u[y=Math.floor(CMath.getRandom(0,u.length))];u.splice(y,1);var b=h[m=Math.floor(CMath.getRandom(0,h.length))];h.splice(m,1),p[d]=b,l--}console.log(" ---------- \u53cc\u500d\u7403 --------------"),console.log(p);for(var g=a.BubbleColors.concat(),f={};s>0&&g.length>0&&u.length>=0;){d=u[y=Math.floor(CMath.getRandom(0,u.length))];u.splice(y,1);var m;b=g[m=Math.floor(CMath.getRandom(0,g.length))];g.splice(m,1),f[d]=b,s--}console.log(" ---------- \u70b8\u5f39\u7403 --------------"),console.log(f);for(var v={};c>0&&u.length>=0;){var y;d=u[y=Math.floor(CMath.getRandom(0,u.length))];u.splice(y,1),v[d]=a.BubbleType.Blank,c--}console.log(" ---------- \u9b54\u6cd5\u7403 --------------"),console.log(v);for(r=0;r<t-1;r++)this.matrixData[r].color=a.BubbleColors[Math.floor(CMath.getRandom()*a.BubbleColors.length)],this.matrixData[r].bubble=null,this.matrixData[r].type=i.Normal,null!=p[r]&&(this.matrixData[r].type=i.Double,this.matrixData[r].color=p[r]),null!=v[r]&&(this.matrixData[r].type=i.Magic,this.matrixData[r].color=v[r]),null!=f[r]&&(this.matrixData[r].type=i.Boom,this.matrixData[r].color=f[r])}else this.firstRow-=1,n.Game.startIndex-=o.MatrixSize;this.addRowTotalCount-=e,console.log(" \u5269\u4f59 ",this.addRowTotalCount," \u884c\u6570\u636e",", \u7b2c\u4e00\u884c\uff1a",this.firstRow,this.index2i(n.Game.startIndex))},e.prototype.ij2index=function(e,t){return e*o.MatrixSize+t},e.prototype.index2i=function(e){return Math.floor(e/o.MatrixSize)},e.prototype.index2j=function(e){return e%o.MatrixSize},e.prototype.getUseIndexStart=function(){return(o.MatrixSize-o.UseSize)/2*(o.MatrixSize+1)-1},e.prototype.getUseIndexEnd=function(){return o.MatrixSize*o.MatrixSize-this.getUseIndexStart()-1},e.prototype.getPosOfIndex=function(e){var t=this.index2i(e),o=this.index2j(e);return this.getPosOfij(t,o)},e.prototype.getPosOfij=function(e,t){var i=cc.v2(0,0);return i.x=(t-o.MatrixSize/2)*a.BubbleSize.width+(e+this.firstRow+n.Game.getMoveTimes())%2*a.BubbleSize.width/2+a.BubbleXOffset,i.y=(o.MatrixSize/2-e+n.Game.getMoveTimes()+this.firstRow-this.index2i(58))*(a.BubbleSize.height+a.BubbleHeightOffset)+a.BubbleYOffset,i},e.prototype.getNeiborMatrix=function(e,t,a){void 0===a&&(a=!1);for(var i=[],r=this.index2i(e),l=n.Game.getMoveTimes()+this.firstRow,s=0;s<=t;s++){var c=r+s,u=r%2==c%2,h=t-Math.floor(s/2);h=Math.min(h,t);for(var p=0;p<=h;p++){var d,b=e+s*o.MatrixSize+p,g=e-s*o.MatrixSize+p,f=e+s*o.MatrixSize-p,m=e-s*o.MatrixSize-p;if(e!=b&&i.indexOf(b)<0&&b>=0&&(b<this.matrixData.length||a))if(u||(c+l)%2==0||p<h)(d=this.index2j(b))>=2&&d<=11&&b>=n.Game.startIndex&&(this.data[b]&&this.data[b].bubble&&!a?i.push(b):!a||this.data[b]&&this.data[b].bubble||i.push(b));if(e!=g&&i.indexOf(g)<0&&g>=0&&(g<this.matrixData.length||a))(d=this.index2j(g))>=2&&d<=11&&g>=n.Game.startIndex&&(u||(c+l)%2==0||p<h)&&(this.data[g]&&this.data[g].bubble&&!a?i.push(g):!a||this.data[g]&&this.data[g].bubble||i.push(g));if(e!=f&&i.indexOf(f)<0&&f>=0&&(f<this.matrixData.length||a))(d=this.index2j(f))>=2&&d<=11&&f>=n.Game.startIndex&&(u||(c+l)%2||p<h)&&(this.data[f]&&this.data[f].bubble&&!a?i.push(f):!a||this.data[f]&&this.data[f].bubble||i.push(f));if(e!=m&&i.indexOf(m)<0&&m>=0&&(m<this.matrixData.length||a))(d=this.index2j(m))>=2&&d<=11&&m>=n.Game.startIndex&&(u||(c+l)%2||p<h)&&(this.data[m]&&this.data[m].bubble&&!a?i.push(m):!a||this.data[m]&&this.data[m].bubble||i.push(m))}}return i.sort(function(e,t){return e-t}),i},e.prototype.initBubbleData=function(){var e=this.getUseIndexStart(),t=this.getUseIndexEnd();this.firstRow=this.index2i(n.Game.startIndex),this.addRowTotalCount=0;var o=Math.ceil(CMath.getRandom(a.DoubleBubbleInitRange.Min,a.DoubleBubbleInitRange.Max)),r=Math.ceil(CMath.getRandom(a.BoomBubbleInitRange.Min,a.BoomBubbleInitRange.Max)),l=Math.ceil(CMath.getRandom(a.MagicBubbleInitRange.Min,a.MagicBubbleInitRange.Max));console.log("start:",e,", end:",t,", firstRow:",this.firstRow),console.log(" double:",o,", boom:",r,", magic:",l);for(var s=[],c=n.Game.startIndex;c<=t;c++)this.index2j(c)>=2&&this.index2j(c)<=11&&s.push(c);for(var u=a.BubbleColors.concat(),h={};o>0&&s.length>=0;){var p=s[v=Math.floor(CMath.getRandom(0,s.length))];s.splice(v,1);var d=u[f=Math.floor(CMath.getRandom(0,u.length))];u.splice(f,1),h[p]=d,o--,u.length<=0&&(u=a.BubbleColors.concat())}console.log(" ---------- \u53cc\u500d\u7403 --------------"),console.log(h);for(var b=a.BubbleColors.concat(),g={};r>0&&s.length>=0;){p=s[v=Math.floor(CMath.getRandom(0,s.length))];s.splice(v,1);var f;d=b[f=Math.floor(CMath.getRandom(0,b.length))];b.splice(f,1),g[p]=d,r--,b.length<=0&&(b=a.BubbleColors.concat())}console.log(" ---------- \u70b8\u5f39\u7403 --------------"),console.log(g);for(var m={};l>0&&s.length>=0;){var v;p=s[v=Math.floor(CMath.getRandom(0,s.length))];s.splice(v,1),m[p]=a.BubbleType.Blank,l--}console.log(" ---------- \u9b54\u6cd5\u7403 --------------"),console.log(m);for(c=e;c<=t;c++){for(var y=this.getNeiborMatrix(c,1),S=[],C=0,M=y;C<M.length;C++){var _=M[C];this.matrixData[_].color!=a.BubbleType.Blank&&S.push(this.matrixData[_])}var x=this.getOtherColors(S);CMath.getRandom()<=.8&&x.length>0?this.matrixData[c].color=x[Math.floor(CMath.getRandom()*x.length)]:this.matrixData[c].color=a.BubbleColors[Math.floor(CMath.getRandom()*a.BubbleColors.length)];for(var T=0;T<y.length;T++){_=y[T];if(this.matrixData[_].color==a.BubbleType.Blank)if(CMath.getRandom()<=.8)this.matrixData[_]=this.matrixData[c];else{var B=this.getOtherColors([this.matrixData[c].color]);this.matrixData[_].color=B[Math.floor(CMath.getRandom()*B.length)]}for(var E=this.getNeiborMatrix(_,1),R=0;R<E.length;R++){var A=E[R];if(this.matrixData[A].color==a.BubbleType.Blank)if(CMath.getRandom()<=.8-.7&&this.matrixData[_]==this.matrixData[c])this.matrixData[A]=this.matrixData[_];else{var G=this.getOtherColors([this.matrixData[c].color,this.matrixData[_].color]);this.matrixData[A].color=G[Math.floor(CMath.getRandom()*G.length)]}}}}for(c=0;c<this.matrixData.length;c++)this.matrixData[c].color==a.BubbleType.Blank&&(this.matrixData[c].color=a.BubbleColors[Math.floor(CMath.getRandom()*a.BubbleColors.length)]),this.matrixData[c].type=i.Normal,null!=h[c]&&(this.matrixData[c].type=i.Double,this.matrixData[c].color=h[c]),null!=m[c]&&(this.matrixData[c].type=i.Magic,this.matrixData[c].color=m[c]),null!=g[c]&&(this.matrixData[c].type=i.Boom,this.matrixData[c].color=g[c]);console.log(this.matrixData.length)},e.prototype.getOtherColors=function(e){for(var t=a.BubbleColors.concat(),o=0,n=e;o<n.length;o++){var i=n[o],r=t.indexOf(i);r<0||t.splice(r,1)}return t},e}();o.BubbleMatrix=r,cc._RF.pop()},{"../Const":"Const","../Controller/Game":"Game"}],BubbleMove:[function(e,t,o){"use strict";cc._RF.push(t,"f122cLSg0BF5pRoYWwgPS74","BubbleMove"),Object.defineProperty(o,"__esModule",{value:!0});var a=e("./Bubble"),n=e("./Controller/EventManager"),i=e("./Controller/EventName"),r=e("./Controller/Game"),l=e("./Const"),s=e("./Controller/GameFactory"),c=e("./Data/BubbleMatrix"),u=cc._decorator,h=u.ccclass;u.property;o.BorderX=455;o.DropBorder=-688,o.CollsionFactor=.3,o.CollsionOffset=40,o.CollsionMinFactor=.01;var p=function(e){function t(){var t=null!==e&&e.apply(this,arguments)||this;return t.speed=cc.v2(0,0),t.acceleration=cc.v2(0,0),t.hasCollision=!1,t.shooted=!1,t.isDrop=!1,t.animationCallback={},t}return __extends(t,e),Object.defineProperty(t.prototype,"Animation",{get:function(){return this.getComponent(cc.Animation)},enumerable:!0,configurable:!0}),Object.defineProperty(t.prototype,"bubble",{get:function(){return this.getComponent(a.default)},enumerable:!0,configurable:!0}),Object.defineProperty(t.prototype,"radis",{get:function(){return l.BubbleSize.width/2},enumerable:!0,configurable:!0}),Object.defineProperty(t.prototype,"isShooterState",{get:function(){return"Shooter"==this.node.getParent().name&&this.node.getNumberOfRunningActions()<=0&&!this.hasCollision&&this.shooted},enumerable:!0,configurable:!0}),Object.defineProperty(t.prototype,"isReady2Shoot",{get:function(){return"Shooter"==this.node.getParent().name&&this.node.getNumberOfRunningActions()<=0},enumerable:!0,configurable:!0}),t.prototype.checkBorder=function(){this.isShooterState&&(this.isDrop||(this.node.x<=-o.BorderX||this.node.x>=o.BorderX)&&(this.node.x=this.node.x>0?o.BorderX:-o.BorderX,this.speed.x=-this.speed.x,this.acceleration.x=-this.acceleration.x))},t.prototype.forceMove=function(e){var t=this.node.getActionByTag(a.BubbleAction.Collision);if(!t||t.isDone()){var o=cc.sequence(cc.moveBy(.1,e).easing(cc.easeQuadraticActionIn()),cc.moveBy(.1,e.mul(-1)).easing(cc.easeQuadraticActionOut()));o.setTag(a.BubbleAction.Collision),this.node.runAction(o)}},t.prototype.checkCollisionBubble=function(){var e=this;if(this.isShooterState&&!this.isDrop)for(var t=r.Game.getCollisionIndexes(),o=r.Game.getMatrix(),a=function(t){var a=o.data[t].bubble;a||console.warn(" bubble \u4e0d\u5b58\u5728\uff01");var s=CMath.ConvertToNodeSpaceAR(l.node,a.node.parent);if(CMath.Distance(s,a.node.position)<=2*l.radis*.8){var u=o.getNeiborMatrix(t,1,!0),h=-1,p=100;console.log("\u78b0\u5230\uff1a",t),console.log(u);for(var d=0,b=u;d<b.length;d++){var g=b[d],f=o.index2i(g),m=o.index2j(g),v=o.getPosOfij(f,m);CMath.Distance(v,s)<p&&(p=CMath.Distance(v,s),h=g)}return l.bubble.Type==c.SpecialType.Magic?a.Type!=c.SpecialType.Magic&&a.node.active&&(l.bubble.setColor(a.Color,c.SpecialType.Normal),n.gEventMgr.emit(i.GlobalEvent.PLAY_EFFECT,"change_color"),l.bubble.playAnimation("bubble_change")):a.Type==c.SpecialType.Magic&&a.node.active&&l.bubble.Type!=c.SpecialType.Horce&&(a.setColor(l.bubble.Color,c.SpecialType.Normal),a.playAnimation("bubble_change"),n.gEventMgr.emit(i.GlobalEvent.PLAY_EFFECT,"change_color")),a.onCollision(),n.gEventMgr.emit(i.GlobalEvent.BUBBLE_FORCE,h),l.onCollision(h,function(){r.Game.checkClear(e.bubble.getIndex(),e.bubble,a),r.Game.updateCollisionIndexes(),n.gEventMgr.emit(i.GlobalEvent.NEXT_BUBBLE)}),"break"}},l=this,s=0,u=t;s<u.length;s++){if("break"===a(u[s]))break}},t.prototype.onCollision=function(e,t){var o=Math.abs(this.speed.x/this.speed.y),a=0==o||isNaN(o)?1.2:1/o,n=1/a;this.speed.x=0,this.speed.y=0,this.acceleration.x=0,this.acceleration.y=0,this.hasCollision=!0;var i=r.Game.getMatrix(),l=i.index2i(e),s=i.index2j(e),c=i.getPosOfij(l,s),u=CMath.ConvertToNodeSpaceAR(this.node,r.Game.BubbleLayer);this.node.x=u.x,this.node.y=u.y,this.node.setParent(r.Game.BubbleLayer),this.node.stopAllActions(),this.scaleBubble(a,n),this.bubble.setIndex(e),this.node.runAction(cc.sequence(cc.moveTo(.1,c),cc.callFunc(function(){t&&t(),r.Game.checkOutOfMove()},this)))},t.prototype.scaleBubble=function(e,t){e=CMath.Clamp(e,1.2,.8),t=CMath.Clamp(t,1.2,.8),this.node.runAction(cc.sequence(cc.scaleTo(.1,e,t),cc.scaleTo(.1,1,1)))},t.prototype.initEvent=function(){n.gEventMgr.targetOff(this),n.gEventMgr.on(i.GlobalEvent.SHOOT,this.shoot,this),n.gEventMgr.on(i.GlobalEvent.BUBBLE_FORCE,this.force,this),this.Animation.on(cc.Animation.EventType.FINISHED,this.onAnimationComplete,this)},t.prototype.force=function(e){var t=this.bubble.getIndex();if(t!=e){var a=r.Game.getMatrix(),n=a.getPosOfIndex(e),i=a.getPosOfIndex(t),l=CMath.Distance(n,i),s=Math.ceil(l/(2*this.radis)),c=Math.pow(o.CollsionFactor,Math.max(0,s-1));this.forceMove(i.sub(n).normalize().mul(c*o.CollsionOffset))}},t.prototype.reuse=function(){this.initEvent(),this.hasCollision=!1,this.isDrop=!1,this.speed=cc.v2(0,0),this.acceleration=cc.v2(0,0),this.shooted=!1,this.node.group="default"},t.prototype.unuse=function(){n.gEventMgr.targetOff(this)},t.prototype.shoot=function(e){"Shooter"==this.node.parent.name&&(this.isReady2Shoot?(console.log("\u53d1\u5c04\uff01"),n.gEventMgr.emit(i.GlobalEvent.PLAY_EFFECT,"shoot"),this.enabled=!0,this.shooted=!0,e.normalizeSelf(),this.speed.x=4800*e.x,this.speed.y=4800*e.y,this.acceleration.x=800*e.x,this.acceleration.y=800*e.y):console.warn(this.node.x,this.node.y))},t.prototype.drop=function(){console.log(" \u6389\u843d:",this.enabled,this.bubble.getIndex()),this.isDrop=!0,this.enabled=!0,this.speed.y=800+CMath.getRandom(0,1e3),this.acceleration.y=4*-this.speed.y,this.speed.x=this.node.x>0?-200:200,this.speed.x*=CMath.getRandom(0,1.5)+1,this.node.group="drop",r.Game.addBubbleDrop(this.bubble.Color)},t.prototype.update=function(e){var t=this;if(this.isShooterState||this.isDrop)for(var c=0;c<10;c++){this.checkBorder(),this.checkCollisionBubble(),this.node.x+=this.speed.x*e/10,this.node.y+=this.speed.y*e/10,this.speed.x+=this.acceleration.x*e/10,this.speed.y+=this.acceleration.y*e/10;var u=CMath.ConvertToNodeSpaceAR(this.node,this.node.getParent().getParent());if(this.isDrop&&u.y<=o.DropBorder){this.enabled=!1,this.scaleBubble(1.1,.9),n.gEventMgr.emit(i.GlobalEvent.PLAY_EFFECT,"drop");var h=this.bubble.DoubleScore?2*a.BubbleDropScore:a.BubbleDropScore;r.Game.addScore(this.bubble.Color,h,1,CMath.ConvertToNodeSpaceAR(this.node,r.Game.TopNode).add(cc.v2(.5*l.BubbleSize.width,.5*l.BubbleSize.height))),this.playAnimation("bubble_drop",function(){s.gFactory.putBubble(t.node)});break}}},t.prototype.playAnimation=function(e,t){this.animationCallback[e]=t,this.Animation.playAdditive(e)},t.prototype.onAnimationComplete=function(e,t){t&&this.animationCallback[t.name]&&(this.animationCallback[t.name](),this.animationCallback[t.name]=null)},t=__decorate([h],t)}(cc.Component);o.default=p,cc._RF.pop()},{"./Bubble":"Bubble","./Const":"Const","./Controller/EventManager":"EventManager","./Controller/EventName":"EventName","./Controller/Game":"Game","./Controller/GameFactory":"GameFactory","./Data/BubbleMatrix":"BubbleMatrix"}],Bubble:[function(e,t,o){"use strict";cc._RF.push(t,"ab9ae70D2ZFXoGg9F2uKBO0","Bubble"),Object.defineProperty(o,"__esModule",{value:!0});var a,n=e("./Controller/EventManager"),i=e("./Controller/Game"),r=e("./Controller/EventName"),l=e("./Const"),s=e("./BubbleMove"),c=e("./Controller/GameFactory"),u=e("./Data/BubbleMatrix");o.BubbleDropScore=10,o.BubbleScoreStep=10,function(e){e[e.Bubble=0]="Bubble",e[e.Collision=1]="Collision"}(a=o.BubbleAction||(o.BubbleAction={}));var h=cc._decorator,p=h.ccclass,d=(h.property,function(e){function t(){var t=null!==e&&e.apply(this,arguments)||this;return t.index=-1,t.color=l.BubbleType.Blank,t.type=u.SpecialType.Normal,t.animationCallback={},t.spriteAtlas=null,t.doubleScore=!1,t}return __extends(t,e),Object.defineProperty(t.prototype,"Animation",{get:function(){return this.getComponent(cc.Animation)},enumerable:!0,configurable:!0}),Object.defineProperty(t.prototype,"sprite",{get:function(){return this.node.getChildByName("Bubble").getComponent(cc.Sprite)},enumerable:!0,configurable:!0}),Object.defineProperty(t.prototype,"move",{get:function(){return this.getComponent(s.default)},enumerable:!0,configurable:!0}),Object.defineProperty(t.prototype,"IndexLabel",{get:function(){return this.node.getChildByName("Index").getComponent(cc.Label)},enumerable:!0,configurable:!0}),Object.defineProperty(t.prototype,"Color",{get:function(){return this.color},enumerable:!0,configurable:!0}),Object.defineProperty(t.prototype,"Type",{get:function(){return this.type},enumerable:!0,configurable:!0}),Object.defineProperty(t.prototype,"Double",{get:function(){return this.node.getChildByName("Bubble").getChildByName("Double")},enumerable:!0,configurable:!0}),Object.defineProperty(t.prototype,"isDouble",{get:function(){return this.type==u.SpecialType.Double},enumerable:!0,configurable:!0}),Object.defineProperty(t.prototype,"DoubleScore",{get:function(){return this.doubleScore},set:function(e){this.doubleScore=e},enumerable:!0,configurable:!0}),t.prototype.reuse=function(){this.node.active=!1,this.node.scale=0,this.type=arguments[0][0],this.color=arguments[0][2],this.spriteAtlas=arguments[0][3],this.sprite.node.opacity=255,this.Double.active=this.type==u.SpecialType.Double,this.doubleScore=!1,this.setIndex(arguments[0][1]),this.updateSprite(),this.initEvent()},t.prototype.unuse=function(){n.gEventMgr.targetOff(this),this.index=-1,this.IndexLabel.string=""},t.prototype.setColor=function(e,t){this.color!=e?(this.color=e,this.type=t):console.warn(" color:",l.BubbleType[this.color],l.BubbleType[e])},t.prototype.updateSprite=function(e){switch(void 0===e&&(e=!1),this.type){case u.SpecialType.Normal:case u.SpecialType.Double:this.sprite.spriteFrame=e?this.spriteAtlas.getSpriteFrame(l.BubbleLightColor[this.Color]):this.spriteAtlas.getSpriteFrame(l.BubbleColor[this.Color]);break;case u.SpecialType.Boom:this.sprite.spriteFrame=e?this.spriteAtlas.getSpriteFrame(l.BoomBubbleLightColor[this.Color]):this.spriteAtlas.getSpriteFrame(l.BoomBubbleColor[this.Color]);break;case u.SpecialType.Horce:this.sprite.spriteFrame=e?this.spriteAtlas.getSpriteFrame(l.HorseBubbleLight):this.spriteAtlas.getSpriteFrame(l.HorseBubble);break;case u.SpecialType.Magic:this.sprite.spriteFrame=e?this.spriteAtlas.getSpriteFrame(l.MagicBubbleLight):this.spriteAtlas.getSpriteFrame(l.MagicBubble)}},t.prototype.setIndex=function(e){if(e!=this.index){var t=i.Game.getMatrix();t.data[e]&&t.data[e].bubble?t.data[e].bubble!=this&&(console.error(this.index,"\u6570\u636e\u4e0d\u540c\u6b65\uff01",e,", oldIndex:",t.data[e].bubble.getIndex()),console.log(t.data[e])):t.data[e]={color:this.color,bubble:this,type:this.type},this.index=e}},t.prototype.updateIndex=function(){""==this.IndexLabel.string?this.IndexLabel.string=this.index.toString():this.IndexLabel.string=""},t.prototype.getIndex=function(){return this.index},t.prototype.setActive=function(e,t,o){this.node.active!=e&&(this.node.active=e,this.node.active||(this.node.scale=0),this.node.active&&t&&this.bubbleScale(o))},t.prototype.initEvent=function(){var e=this;this.node.on(cc.Node.EventType.TOUCH_END,function(){var t=i.Game.getMatrix().getNeiborMatrix(e.index,1);console.log(t),n.gEventMgr.emit(r.GlobalEvent.BUBBLE_SCALE_TEST,t)},this),n.gEventMgr.on(r.GlobalEvent.BUBBLE_SCALE_TEST,this.scaleTest,this),this.Animation.on(cc.Animation.EventType.FINISHED,this.onAnimationComplete,this),this.node._onSetParent=this.onSetParent.bind(this)},t.prototype.updateActive=function(e){void 0===e&&(e=0),this.setActive(this.node.y<this.node.parent.height,!0,e)},t.prototype.scaleTest=function(e){e.indexOf(this.index)<0||this.bubbleScale()},t.prototype.bubbleScale=function(e){void 0===e&&(e=0);var t=cc.sequence(cc.scaleTo(0,0),cc.delayTime(e),cc.scaleTo(.2,.9),cc.scaleTo(.1,1.1),cc.scaleTo(.1,1));t.setTag(a.Bubble),this.node.stopActionByTag(a.Bubble),this.node.runAction(t)},t.prototype.onSetParent=function(e){e&&(this.move.enabled="Shooter"==e.name)},t.prototype.onCollision=function(){n.gEventMgr.emit(r.GlobalEvent.PLAY_EFFECT,"colision")},t.prototype.onClear=function(e,t){var a=this;i.Game.addBubbleClear(this.Color),n.gEventMgr.emit(r.GlobalEvent.PLAY_EFFECT,this.type==u.SpecialType.Boom?"boom":"clear"),this.node.runAction(cc.sequence(cc.delayTime(.7*e),cc.callFunc(function(){var e=i.Game.getMatrix().index2i(a.index),n=i.Game.getMatrix().index2j(a.index),r=i.Game.getMatrix().index2i(t),s=i.Game.getMatrix().index2j(t),h=Math.max(Math.abs(e-r)+1,Math.abs(n-s)+1),p=Math.max(1,h)*o.BubbleScoreStep;a.DoubleScore&&(p*=2);var d=.1*h+1;i.Game.addScore(a.color,p,d,CMath.ConvertToNodeSpaceAR(a.node,i.Game.TopNode).add(cc.v2(.5*l.BubbleSize.width,.5*l.BubbleSize.height))),a.updateSprite(!0);var b=a.type==u.SpecialType.Boom?"bubble_boom":"bubble_disappear";a.playAnimation(b,function(){c.gFactory.putBubble(a.node)})},this)))},t.prototype.playAnimation=function(e,t){this.animationCallback[e]=t,this.Animation.playAdditive(e)},t.prototype.onAnimationComplete=function(e,t){t&&this.animationCallback[t.name]&&(this.animationCallback[t.name](),this.animationCallback[t.name]=null)},t.prototype.update=function(e){i.Game.getCollisionIndexes().indexOf(this.index)>=0?this.IndexLabel.node.color=cc.Color.BLACK:this.IndexLabel.node.color=cc.Color.WHITE},t=__decorate([p],t)}(cc.Component));o.default=d,cc._RF.pop()},{"./BubbleMove":"BubbleMove","./Const":"Const","./Controller/EventManager":"EventManager","./Controller/EventName":"EventName","./Controller/Game":"Game","./Controller/GameFactory":"GameFactory","./Data/BubbleMatrix":"BubbleMatrix"}],Const:[function(e,t,o){"use strict";var a,n,i;cc._RF.push(t,"f7b813ZcfJE5JVv1NvPFZPC","Const"),Object.defineProperty(o,"__esModule",{value:!0}),o.BubbleColor={0:"blank",1:"bg_popblue",2:"bg_popgreen",3:"bg_poporange",4:"bg_poppurple",5:"bg_popred",6:"bg_popyellow"},o.BubbleLightColor={0:"blank",1:"bg_popbluelight",2:"bg_popgreenlight",3:"bg_poporangelight",4:"bg_poppurplelight",5:"bg_popredlight",6:"bg_popyellowlight"},o.BoomBubbleLightColor={0:"blank",1:"bomb_bluelight",2:"bomb_greenlight",3:"bomb_orangelight",4:"bomb_purplelight",5:"bomb_redlight",6:"bomb_yellowlight"},o.BoomBubbleColor={0:"blank",1:"bomb_blue",2:"bomb_green",3:"bomb_orange",4:"bomb_purple",5:"bomb_red",6:"bomb_yellow"},o.HorseBubble="horse",o.HorseBubbleLight="horselight",o.MagicBubble="rainbow",o.MagicBubbleLight="rainbowlight",function(e){e[e.Blank=0]="Blank",e[e.Blue=1]="Blue",e[e.Green=2]="Green",e[e.Orange=3]="Orange",e[e.Purple=4]="Purple",e[e.Red=5]="Red",e[e.Yellow=6]="Yellow",e[e.Horce=7]="Horce",e[e.Treasure_200=200]="Treasure_200",e[e.Treasure_400=400]="Treasure_400",e[e.Treasure_600=600]="Treasure_600",e[e.Treasure_800=800]="Treasure_800",e[e.Treasure_1000=1e3]="Treasure_1000",e[e.Streak=1001]="Streak"}(a=o.BubbleType||(o.BubbleType={})),o.BubbleColors=[a.Yellow,a.Red,a.Purple,a.Orange,a.Green,a.Blue],o.BubbleHeightOffset=-15,o.BubbleYOffset=1265,o.BubbleXOffset=20,o.BubbleSize=cc.size(94,94),o.BubbleQueRange={Min:4,Max:9},o.ClearTargetRange={Min:2,Max:6},o.GameTime=180,o.TargetRandomLimit=120,o.DefaultTaskCount=9,o.DoubleBubbleInitRange={Min:3,Max:5},o.DoubleBubbleRange={Min:1,Max:2},o.BoomBubbleRange={Min:1,Max:2},o.MagicBubbleRange={Min:0,Max:1},o.BoomBubbleInitRange={Min:3,Max:5},o.MagicBubbleInitRange={Min:0,Max:3},o.ClearCountLimit=3,o.ShooterDoubleRange={Min:6,Max:10},o.ShooterDoubleBubbleRange={Min:0,Max:1},o.ShooterBoomRange={Min:6,Max:10},o.ShooterBoomBubbleRange={Min:0,Max:1},o.ShooterMagicRange={Min:4,Max:6},o.ShooterMagicBubbleRange={Min:0,Max:1},o.TaskStreakAward=3,function(e){e[e.Spring=0]="Spring",e[e.Summer=1]="Summer",e[e.Autumn=2]="Autumn",e[e.Winter=3]="Winter"}(n=o.Season||(o.Season={})),o.SeasonPool=[n.Autumn,n.Spring,n.Summer,n.Winter],function(e){e[e.Level_200=200]="Level_200",e[e.Level_400=400]="Level_400",e[e.Level_600=600]="Level_600",e[e.Level_800=800]="Level_800",e[e.Level_1000=1e3]="Level_1000"}(i=o.TreasureType||(o.TreasureType={})),o.TreasurePool=[i.Level_200,i.Level_400,i.Level_600,i.Level_800,i.Level_1000],o.Treasure_Top={0:{200:"bg_sfinish200",400:"bg_sfinish400",600:"bg_sfinish600",800:"bg_sfinish800",1000:"bg_sfinish1000"},1:{200:"bg_smfinish200",400:"bg_smfinish400",600:"bg_smfinish600",800:"bg_smfinish800",1000:"bg_smfinish1000"},2:{200:"bg_afinish200",400:"bg_afinish400",600:"bg_afinish600",800:"bg_afinish800",1000:"bg_afinish1000"},3:{200:"bg_wfinish200",400:"bg_wfinish400",600:"bg_wfinish600",800:"bg_wfinish800",1000:"bg_wfinish1000"}},function(e){e[e.OUT_OF_MOVE=0]="OUT_OF_MOVE",e[e.TIME_UP=1]="TIME_UP"}(o.OverType||(o.OverType={})),cc._RF.pop()},{}],EventManager:[function(e,t,o){"use strict";cc._RF.push(t,"1be43vsI5VEx6cptNa56Bfq","EventManager"),Object.defineProperty(o,"__esModule",{value:!0});var a=function(){function e(){this.eventTarget=new cc.EventTarget}return Object.defineProperty(e,"inst",{get:function(){return this.ins?this.ins:this.ins=new e},enumerable:!0,configurable:!0}),e.prototype.emit=function(e,t,o,a,n,i){this.eventTarget.emit(e.toString(),t,o,a,n,i)},e.prototype.on=function(e,t,o,a){return this.eventTarget.on(e.toString(),t,o,a)},e.prototype.once=function(e,t,o){this.eventTarget.once(e.toString(),t,o)},e.prototype.dispatchEvent=function(e){this.eventTarget.dispatchEvent(e)},e.prototype.off=function(e,t,o){this.eventTarget.off(e.toString(),t,o)},e.prototype.hasEventListener=function(e){return this.eventTarget.hasEventListener(e.toString())},e.prototype.targetOff=function(e){this.eventTarget.targetOff(e)},e}();o.gEventMgr=a.inst,cc._RF.pop()},{}],EventName:[function(e,t,o){"use strict";cc._RF.push(t,"017c8l+T9FHF5CNitqArJpl","EventName"),Object.defineProperty(o,"__esModule",{value:!0}),function(e){e[e.BUBBLE_SCALE_TEST=0]="BUBBLE_SCALE_TEST",e[e.SMALL_BGM=1]="SMALL_BGM",e[e.NORMAL_BGM=2]="NORMAL_BGM",e[e.SHOOT=3]="SHOOT",e[e.BUBBLE_FORCE=4]="BUBBLE_FORCE",e[e.ADD_BUBBLE=5]="ADD_BUBBLE",e[e.ADD_SCORE=6]="ADD_SCORE",e[e.GAME_OVER=7]="GAME_OVER",e[e.UPDATE_TASK=8]="UPDATE_TASK",e[e.NEXT_BUBBLE=9]="NEXT_BUBBLE",e[e.PLAY_EFFECT=10]="PLAY_EFFECT",e[e.HORCE_CLEAR=11]="HORCE_CLEAR",e[e.GET_TREASURE=12]="GET_TREASURE",e[e.CHECK_TREASURE=13]="CHECK_TREASURE",e[e.CHANGE_BGM=14]="CHANGE_BGM",e[e.SHOW_STREAK=15]="SHOW_STREAK"}(o.GlobalEvent||(o.GlobalEvent={})),cc._RF.pop()},{}],GameFactory:[function(e,t,o){"use strict";cc._RF.push(t,"949976qNuFDsoz+OUdWWlhf","GameFactory"),Object.defineProperty(o,"__esModule",{value:!0});var a,n=e("../Utils/HashMap"),i=function(){function e(e,t,o){this._pool=[],this.poolHandlerComps=[],this.poolHandlerComps=o,this.template=e,this.initPool(t)}return e.prototype.initPool=function(e){for(var t=0;t<e;++t){var o=cc.instantiate(this.template);this.put(o)}},e.prototype.size=function(){return this._pool.length},e.prototype.clear=function(){for(var e=this._pool.length,t=0;t<e;++t)this._pool[t].destroy&&this._pool[t].destroy();this._pool.length=0},e.prototype.put=function(e){if(e&&-1===this._pool.indexOf(e)){if(e.removeFromParent(!1),this.poolHandlerComps)for(var t=0,o=this.poolHandlerComps;t<o.length;t++){var a=o[t],n=e.getComponent(a);n&&n.unuse&&n.unuse.apply(n)}else for(var i=0,r=e.getComponents(cc.Component);i<r.length;i++){(a=r[i])&&a.unuse&&a.unuse.apply(a)}this._pool.push(e)}},e.prototype.get=function(){for(var e=[],t=0;t<arguments.length;t++)e[t]=arguments[t];var o=this._pool.length-1;o<0&&(console.warn(" last < 0 "),this.initPool(1)),o=this._pool.length-1;var a=this._pool[o];if(this._pool.length=o,this.poolHandlerComps)for(var n=0,i=this.poolHandlerComps;n<i.length;n++){var r=i[n],l=a.getComponent(r);l&&l.reuse&&l.reuse.apply(l,arguments)}else for(var s=0,c=a.getComponents(cc.Component);s<c.length;s++){(r=c[s])&&r.reuse&&r.reuse.apply(r,arguments)}return a},e}();(function(e){e[e.INIT=0]="INIT",e[e.Bubble=4]="Bubble",e[e.Point=8]="Point",e[e.Task=16]="Task",e[e.Score=32]="Score",e[e.Font=64]="Font",e[e.DONE=124]="DONE"})(a||(a={}));var r=function(){function e(){this.step=a.INIT,this.BubblePool=new n.HashMap,this.PointPool=new n.HashMap,this.TaskPool=new n.HashMap,this.ScorePool=new n.HashMap,this.FontPool=new n.HashMap}return Object.defineProperty(e,"inst",{get:function(){return this.ins?this.ins:this.ins=new e},enumerable:!0,configurable:!0}),e.prototype.init=function(e,t,o,a,n,i){this.doneCallback=e,this.initBubble(200,t),this.initPoint(20,o),this.initTask(8,a),this.initScore(30,n),this.initFont(5,i)},e.prototype.nextStep=function(e){this.step|=e,this.step>=a.DONE&&this.doneCallback&&this.doneCallback()},e.prototype.initBubble=function(e,t){var o=this;t?(o.BubblePool.add("Bubble",new i(t,e)),o.nextStep(a.Bubble)):cc.loader.loadRes("prefabs/Bubble",cc.Prefab,function(t,n){t?console.error(t):(o.BubblePool.add("Bubble",new i(n,e)),o.nextStep(a.Bubble))})},e.prototype.getBubble=function(){for(var e=[],t=0;t<arguments.length;t++)e[t]=arguments[t];return this.BubblePool.get("Bubble").get(e)},e.prototype.putBubble=function(e){this.BubblePool.get("Bubble").put(e)},e.prototype.initPoint=function(e,t){var o=this;t?(o.PointPool.add("Point",new i(t,e)),o.nextStep(a.Point)):cc.loader.loadRes("prefabs/Point",cc.Prefab,function(t,n){t?console.error(t):(o.PointPool.add("Point",new i(n,e)),o.nextStep(a.Point))})},e.prototype.getPoint=function(){for(var e=[],t=0;t<arguments.length;t++)e[t]=arguments[t];return this.PointPool.get("Point").get(e)},e.prototype.putPoint=function(e){this.PointPool.get("Point").put(e)},e.prototype.initTask=function(e,t){var o=this;t?(o.TaskPool.add("Task",new i(t,e)),o.nextStep(a.Task)):cc.loader.loadRes("prefabs/Mission",cc.Prefab,function(t,n){t?console.error(t):(o.TaskPool.add("Task",new i(n,e)),o.nextStep(a.Task))})},e.prototype.getTask=function(){for(var e=[],t=0;t<arguments.length;t++)e[t]=arguments[t];return this.TaskPool.get("Task").get(e)},e.prototype.putTask=function(e){this.TaskPool.get("Task").put(e)},e.prototype.initScore=function(e,t){var o=this;t?(o.ScorePool.add("Score",new i(t,e)),o.nextStep(a.Score)):cc.loader.loadRes("prefabs/ScoreFloat",cc.Prefab,function(t,n){t?console.error(t):(o.ScorePool.add("Score",new i(n,e)),o.nextStep(a.Score))})},e.prototype.getScore=function(){for(var e=[],t=0;t<arguments.length;t++)e[t]=arguments[t];return this.ScorePool.get("Score").get(e)},e.prototype.putScore=function(e){this.ScorePool.get("Score").put(e)},e.prototype.initFont=function(e,t){var o=this;t?(o.FontPool.add("Font",new i(t,e)),o.nextStep(a.Font)):cc.loader.loadRes("prefabs/Font",cc.Prefab,function(t,n){t?console.error(t):(o.FontPool.add("Font",new i(n,e)),o.nextStep(a.Font))})},e.prototype.getFont=function(){for(var e=[],t=0;t<arguments.length;t++)e[t]=arguments[t];return this.FontPool.get("Font").get(e)},e.prototype.putFont=function(e){this.FontPool.get("Font").put(e)},e}();o.gFactory=r.inst,cc._RF.pop()},{"../Utils/HashMap":"HashMap"}],GameScene:[function(e,t,o){"use strict";cc._RF.push(t,"63c91B5GQpJwrTOBvKO60W6","GameScene"),Object.defineProperty(o,"__esModule",{value:!0});var a,n=e("./Controller/GameFactory"),i=e("./Controller/Game"),r=e("./Const"),l=e("./Data/BubbleMatrix"),s=e("./Bubble"),c=e("./Controller/EventManager"),u=e("./Controller/StepController"),h=e("./Controller/AudioController"),p=e("./Controller/EventName"),d=e("./Guide"),b=e("./ResultLayer"),g=e("./Utils/celerx");(function(e){e.Prefab="Prefab",e.Audio="Audio"})(a||(a={}));var f=cc._decorator,m=f.ccclass,v=f.property,y=function(e){function t(){var t=null!==e&&e.apply(this,arguments)||this;return t.BubblePrefab=null,t.PointPrefab=null,t.TaskPrefab=null,t.AddScorePrefab=null,t.BubbleAtlas=null,t.SpringBack=null,t.SummerBack=null,t.AutumnBack=null,t.WinterBack=null,t.TreasureAtlas=null,t.TreasureIconAtlas=null,t.Guide=null,t.Background=null,t.Effect=null,t.FontAtlas=null,t.TimeFont=null,t.FontPrefab=null,t.FontRoot=null,t.TreasureRoot=null,t.BigTreasure=null,t.SmallTreasure=null,t.ResultTitle=null,t.ResultFont=null,t.BubbleLayer=null,t.Shooter=null,t.TopNode=null,t.BulletArray=null,t.TaskArray=null,t.ShooterLayer=null,t.TimeLabel=null,t.ScoreLabel=null,t.Help=null,t.showScore=0,t.score=0,t.addScoreStep=0,t}return __extends(t,e),t.prototype.onLoad=function(){this.ResultFont.node.scale=0,i.Game.FontRoot=this.FontRoot,i.Game.BubbleLayer=this.BubbleLayer,i.Game.TopNode=this.TopNode;var e=this;g.onStart(function(){e.celerOnStart()}.bind(this)),g.provideScore(function(){return parseInt(i.Game.getScore().toString())}),u.gStep.register(this.celerReady.bind(this),[a.Audio,a.Prefab]),i.Game.prepare(),n.gFactory.init(function(){u.gStep.nextStep(a.Prefab)},this.BubblePrefab,this.PointPrefab,this.TaskPrefab,this.AddScorePrefab,this.FontPrefab),h.gAudio.init(function(){u.gStep.nextStep(a.Audio)}),this.initEvent(),this.TimeLabel.node.getChildByName("noTime").opacity=0},t.prototype.celerReady=function(){g.ready()},t.prototype.celerOnStart=function(){var e=g.getMatch();e&&e.sharedRandomSeed?(CMath.randomSeed=e.sharedRandomSeed,CMath.sharedSeed=e.sharedRandomSeed):CMath.randomSeed=Math.random(),e&&e.shouldLaunchTutorial?this.Guide.show():this.Guide.hide();var t=!1,o=document.getElementsByTagName("canvas")[0];cc.director.on(cc.Director.EVENT_AFTER_DRAW,function(){t&&(t=!1,g.didTakeSnapshot(o.toDataURL()))}),g.provideCurrentFrameData(function(){t=!0}),i.Game.start(),this.updateSeason(),this.updateTreasure(),this.show()},t.prototype.updateTreasure=function(){for(var e=0,t=this.TreasureRoot.children;e<t.length;e++){(p=t[e]).getChildByName("icon").getComponent(cc.Sprite).spriteFrame=this.TreasureAtlas.getSpriteFrame(r.Treasure_Top[i.Game.Season][p.name])}for(var o=[r.TreasureType.Level_1000,r.TreasureType.Level_800],a=function(e){var t=Math.floor(CMath.getRandom(0,o.length)),a=o[t];cc.loader.loadRes("prefabs/"+r.Season[i.Game.Season]+"/"+a,cc.Prefab,function(t,o){if(t)console.error(" load treasure err:",t);else{var a=cc.instantiate(o);e.addChild(a)}}),o.splice(t,1)},n=0,l=this.BigTreasure.children;n<l.length;n++){a(p=l[n])}for(var s=[r.TreasureType.Level_200,r.TreasureType.Level_400,r.TreasureType.Level_600],c=function(e){var t=Math.floor(CMath.getRandom(0,s.length)),o=s[t];cc.loader.loadRes("prefabs/"+r.Season[i.Game.Season]+"/"+o,cc.Prefab,function(t,o){if(t)console.error(" load treasure err:",t);else{var a=cc.instantiate(o);e.addChild(a)}}),s.splice(t,1)},u=0,h=this.SmallTreasure.children;u<h.length;u++){var p;c(p=h[u])}},t.prototype.updateSeason=function(){switch(i.Game.Season){case r.Season.Spring:this.Background.spriteFrame=this.SpringBack;break;case r.Season.Autumn:this.Background.spriteFrame=this.AutumnBack;break;case r.Season.Summer:this.Background.spriteFrame=this.SummerBack;break;case r.Season.Winter:this.Background.spriteFrame=this.WinterBack}},t.prototype.initEvent=function(){var e=this;c.gEventMgr.targetOff(this),this.BulletArray.on(cc.Node.EventType.CHILD_REMOVED,this.onBubbleQueRemoveChild,this),this.Shooter.on(cc.Node.EventType.CHILD_REMOVED,this.onShooterRemoveChild,this),this.Help.on(cc.Node.EventType.TOUCH_END,function(){e.Guide.show()},this),c.gEventMgr.on(p.GlobalEvent.HORCE_CLEAR,function(){e.Effect.play("super_clear")},this),c.gEventMgr.on(p.GlobalEvent.GET_TREASURE,function(t){var o=e.TreasureRoot.getChildByName(t);o&&o.getComponent(cc.Animation).play()},this),c.gEventMgr.on(p.GlobalEvent.SHOW_STREAK,function(t,o){if(t){var a=null;switch(o){case 2:a=e.FontAtlas.getSpriteFrame("f_streak");break;case 3:a=e.FontAtlas.getSpriteFrame("f_sstreak");break;case 4:a=e.FontAtlas.getSpriteFrame("f_great");break;case 5:a=e.FontAtlas.getSpriteFrame("f_amazing");break;default:a=e.FontAtlas.getSpriteFrame("f_awesome")}var l=n.gFactory.getFont();l.getComponent(cc.Sprite).spriteFrame=a,l.scale=0,l.opacity=255,e.FontRoot.addChild(l),l.x=0;var s=1+.1*o;l.y=e.FontRoot.childrenCount*(150*s),c.gEventMgr.emit(p.GlobalEvent.PLAY_EFFECT,"font"),l.runAction(cc.sequence(cc.scaleTo(.1,s),cc.delayTime(.3),cc.callFunc(function(){if(t){i.Game.addScore(r.BubbleType.Streak,25+15*(o-2),.3*(o-2)+2,CMath.ConvertToNodeSpaceAR(l,e.TopNode).add(cc.v2(l.width/2,l.height/2)))}},e),cc.spawn(cc.scaleTo(.2,1),cc.fadeTo(.2,0)),cc.callFunc(function(){n.gFactory.putFont(l)},e)))}},this),c.gEventMgr.on(p.GlobalEvent.ADD_BUBBLE,this.addNextBubble,this),c.gEventMgr.on(p.GlobalEvent.UPDATE_TASK,this.updateTask,this),c.gEventMgr.on(p.GlobalEvent.NEXT_BUBBLE,this.getShooterBubble,this),c.gEventMgr.on(p.GlobalEvent.ADD_SCORE,this.addScore,this),c.gEventMgr.on(p.GlobalEvent.GAME_OVER,function(t){c.gEventMgr.off(p.GlobalEvent.GAME_OVER),i.Game.isStart=!1,t==r.OverType.OUT_OF_MOVE?e.ResultFont.spriteFrame=e.ResultTitle.getSpriteFrame("bg_result_font2"):e.ResultFont.spriteFrame=e.ResultTitle.getSpriteFrame("bg_result_font1"),e.ResultFont.node.runAction(cc.sequence(cc.scaleTo(.1,1.5),cc.delayTime(.3),cc.scaleTo(.1,1.2),cc.callFunc(function(){cc.loader.loadRes("prefabs/"+r.Season[i.Game.Season]+"/ResultLayer",cc.Prefab,function(o,a){if(o)cc.error("load result :",o),g.submitScore(i.Game.getScore());else{var n=void 0;n=t==r.OverType.OUT_OF_MOVE?e.ResultTitle.getSpriteFrame("bg_result_font2"):e.ResultTitle.getSpriteFrame("bg_result_font1");var l=cc.instantiate(a);l.getComponent(b.default).setTexture(n),e.node.addChild(l)}})},e)))},this)},t.prototype.updateTask=function(){var e=i.Game.getCurTarget();console.log(e);for(var t=0;t<Math.min(e.now,this.TaskArray.childrenCount);t++){var o=this.TaskArray.children[t],a=o.getChildByName("Complete");0==o.scale||a.scale>.5||a.runAction(cc.sequence(cc.scaleTo(.1,.9),cc.scaleTo(.1,.6)))}},t.prototype.addNextBubble=function(e){for(void 0===e&&(e=1);e--;)this.nextBubble()},t.prototype.show=function(){this.addBubble(3,13,2,11),this.getNewTask(r.DefaultTaskCount)},t.prototype.nextBubble=function(){i.Game.addMoveTimes();var e=i.Game.getMatrix();e.moveRow(1),this.BubbleLayer.height+=r.BubbleSize.height+r.BubbleHeightOffset,this.BubbleLayer.runAction(cc.sequence(cc.moveBy(.2,0,-(r.BubbleSize.height+r.BubbleHeightOffset)),cc.callFunc(function(){i.Game.checkOutOfMove()},this))),this.addBubble(e.index2i(i.Game.startIndex)-1,e.index2i(i.Game.startIndex)-1,2,11,1);for(var t=i.Game.startIndex;t<=i.Game.startIndex+l.UseSize-1;t++){if(!e.data[t]||!e.data[t].bubble)return;e.data[t].bubble.updateActive(t/700+(t-i.Game.startIndex)/50)}},t.prototype.addBubble=function(e,t,o,a,n){void 0===n&&(n=0);for(var r=i.Game.getMatrix(),l=e;l<=t;l++)for(var c=o;c<=a;c++){var u=r.ij2index(l,c),h=i.Game.getBubble(r.data[u].type,u,r.data[u].color,this.BubbleAtlas),p=r.getPosOfij(l,c);h.x=p.x,h.y=p.y,this.BubbleLayer.addChild(h),r.data[u].bubble=h.getComponent(s.default),h.getComponent(s.default).updateActive(u/700+(u-i.Game.startIndex)/50*n)}i.Game.updateCollisionIndexes()},t.prototype.onShooterRemoveChild=function(){},t.prototype.getShooterBubble=function(e){if(this.BulletArray.childrenCount<=0){var t=i.Game.getCurTarget();return t.now<t.target&&this.addNextBubble(1),void this.getNewTask(e)}var o=this.BulletArray.children[0];o.setParent(this.Shooter),o.scale=.5,o.setPosition(CMath.ConvertToNodeSpaceAR(o,this.Shooter)),o.runAction(cc.spawn(cc.scaleTo(.2,1),cc.fadeTo(.2,255),cc.moveTo(.3,0,0),cc.callFunc(function(){})))},t.prototype.getNewTask=function(e){var t=this;i.Game.streak=0,e||(e=Math.ceil(CMath.getRandom(r.BubbleQueRange.Min,r.BubbleQueRange.Max))),console.error("\u6ce1\u6ce1\u961f\u5217\uff1a",e);for(var o=[],a=0;a<e;a++)o.push(a);var u=Math.ceil(CMath.getRandom(r.ShooterDoubleRange.Min,r.ShooterDoubleRange.Max)),h=0,d=r.BubbleColors.concat(),b={};if(i.Game.getTaskLength()%u==0)for(h=Math.ceil(CMath.getRandom(r.ShooterDoubleBubbleRange.Min,r.ShooterDoubleBubbleRange.Max));h-- >0&&o.length>0;){var g=o[a=Math.floor(CMath.getRandom(0,o.length))];o.splice(a,1);var f=d[C=Math.floor(CMath.getRandom(0,d.length))];d.splice(C,1),d.length<=0&&(d=r.BubbleColors.concat()),b[g]=f}var m=Math.ceil(CMath.getRandom(r.ShooterBoomRange.Min,r.ShooterBoomRange.Max)),v=0,y=r.BubbleColors.concat(),S={};if(i.Game.getTaskLength()%m==0)for(v=Math.ceil(CMath.getRandom(r.ShooterBoomBubbleRange.Min,r.ShooterBoomBubbleRange.Max));v-- >0&&o.length>0;){g=o[a=Math.floor(CMath.getRandom(0,o.length))];o.splice(a,1);var C;f=y[C=Math.floor(CMath.getRandom(0,y.length))];y.splice(C,1),y.length<=0&&(y=r.BubbleColors.concat()),S[g]=f}var M=Math.ceil(CMath.getRandom(r.ShooterMagicRange.Min,r.ShooterMagicRange.Max)),_=0,x={};if(i.Game.getTaskLength()%M==0)for(_=Math.ceil(CMath.getRandom(r.ShooterMagicBubbleRange.Min,r.ShooterMagicBubbleRange.Max));_-- >0&&o.length>0;){g=o[a=Math.floor(CMath.getRandom(0,o.length))];o.splice(a,1),x[g]=r.BubbleType.Blank}var T=[];for(a=0;a<e;a++)T.push(r.BubbleColors[Math.floor(CMath.getRandom()*r.BubbleColors.length)]);var B=i.Game.getCurTarget();B.now>=B.target&&B.target>0?(i.Game.addTaskStreak(1),c.gEventMgr.emit(p.GlobalEvent.PLAY_EFFECT,"task_success")):(i.Game.addTaskStreak(-i.Game.getTaskStreak()),B.target>0&&c.gEventMgr.emit(p.GlobalEvent.PLAY_EFFECT,"task_fail"));var E=function(e){var t=T[e],o=l.SpecialType.Normal;b[e]&&(o=l.SpecialType.Double,t=b[e]),S[e]&&(o=l.SpecialType.Boom,t=S[e]),null!=x[e]&&(o=l.SpecialType.Magic,t=x[e]);var a=i.Game.getBubble(o,-1,t,R.BubbleAtlas);if(a.getComponent(s.default).setActive(!0,!0,e/50),a.scale=0,a.opacity=0,a.y=0,0==e){a.x=-200,R.Shooter.addChild(a);var n=!1;i.Game.getTaskStreak()>=r.TaskStreakAward&&(i.Game.addTaskStreak(-i.Game.getTaskStreak()),n=!0),a.runAction(cc.spawn(cc.scaleTo(.2,1),cc.fadeTo(.2,255),cc.moveTo(.3,0,0),cc.callFunc(function(){n&&(c.gEventMgr.emit(p.GlobalEvent.PLAY_EFFECT,"change_horce"),a.getComponent(s.default).setColor(r.BubbleType.Horce,l.SpecialType.Horce),a.getComponent(s.default).playAnimation("bubble_horce"))})))}else a.x=-200*e,R.BulletArray.addChild(a),a.runAction(cc.spawn(cc.scaleTo(.2,.5),cc.fadeTo(.2,255),cc.moveTo(.4,40-R.BulletArray.childrenCount*r.BubbleSize.width,0)))},R=this;for(a=0;a<T.length;a++)E(a);var A=CMath.getRandom(),G=0;if(G=i.Game.getGameTime()>=120?A<=.6?CMath.Clamp(e-Math.ceil(CMath.getRandom(2,10)),r.ClearTargetRange.Max,r.ClearTargetRange.Min):A<=.3?CMath.Clamp(e-Math.ceil(CMath.getRandom(1,2)),r.ClearTargetRange.Max,r.ClearTargetRange.Min):CMath.Clamp(e,r.ClearTargetRange.Max,r.ClearTargetRange.Min):A<=.6?CMath.Clamp(e-Math.ceil(CMath.getRandom(1,2)),r.ClearTargetRange.Max,r.ClearTargetRange.Min):A<=.2?CMath.Clamp(e-Math.ceil(CMath.getRandom(2,10)),r.ClearTargetRange.Max,r.ClearTargetRange.Min):CMath.Clamp(e,r.ClearTargetRange.Max,r.ClearTargetRange.Min),G=Math.min(e-1,G),console.error("\u4efb\u52a1\u6570\uff1a",G),this.TaskArray.childrenCount>0){var F=function(e){var o=k.TaskArray.children[e],a=o.getChildByName("Complete"),n=o.getChildByName("Fail");B.now>=B.target?o.runAction(cc.sequence(cc.delayTime(e/10),cc.scaleTo(.1,0),cc.callFunc(function(){e==t.TaskArray.childrenCount-1&&c.gEventMgr.emit(p.GlobalEvent.PLAY_EFFECT,"new_task"),a.stopAllActions(),a.scale=0,n.scale=0,e<=G-1&&o.runAction(cc.sequence(cc.delayTime(0),cc.scaleTo(.1,1.2),cc.delayTime(.05),cc.scaleTo(.1,1)))}))):(a.stopAllActions(),a.scale=0,n.runAction(cc.sequence(cc.delayTime(e/10),cc.scaleTo(.1,1),cc.delayTime(.2),cc.callFunc(function(){e==t.TaskArray.childrenCount-1&&c.gEventMgr.emit(p.GlobalEvent.PLAY_EFFECT,"new_task"),o.runAction(cc.sequence(cc.delayTime(e/10),cc.scaleTo(.1,0),cc.callFunc(function(){n.scale=0,e<=G-1&&o.runAction(cc.sequence(cc.delayTime(0),cc.scaleTo(.1,1.2),cc.delayTime(.05),cc.scaleTo(.1,1)))})))}))))},k=this;for(a=0;a<this.TaskArray.childrenCount;a++)F(a)}else for(c.gEventMgr.emit(p.GlobalEvent.PLAY_EFFECT,"new_task");this.TaskArray.childrenCount<6;){var P=n.gFactory.getTask();P.y=0,P.x=this.TaskArray.childrenCount*P.width*1.3+30,P.scale=0,this.TaskArray.childrenCount<G&&P.runAction(cc.sequence(cc.delayTime(this.TaskArray.childrenCount/10),cc.scaleTo(.1,1.2),cc.delayTime(.05),cc.scaleTo(.1,1))),this.TaskArray.addChild(P),P.getChildByName("Complete").scale=0,P.getChildByName("Fail").scale=0}i.Game.pushTarget({now:0,target:G})},t.prototype.onBubbleQueRemoveChild=function(){for(var e=0,t=this.BulletArray.children;e<t.length;e++){t[e].runAction(cc.moveBy(.2,r.BubbleSize.width,0))}},t.prototype.addScore=function(e,t,o){var a=this;void 0===o&&(o=cc.v2(0,0)),t*=1.1;var r=n.gFactory.getScore();r.scale=0,r.opacity=255,r.getComponent(cc.Label).string="/"+e.toString(),this.TopNode.addChild(r),r.setPosition(o);var l=CMath.Distance(o,this.ScoreLabel.node.position)/1560;r.runAction(cc.sequence(cc.delayTime(.4),cc.fadeTo(l+.3,0))),r.runAction(cc.sequence(cc.scaleTo(.1,1.2*t),cc.delayTime(.2),cc.scaleTo(.1,1*t),cc.moveTo(l,this.ScoreLabel.node.position).easing(cc.easeInOut(1)),cc.scaleTo(.3,0),cc.callFunc(function(){a.score=i.Game.getScore(),a.addScoreStep=(a.score-a.showScore)/20,n.gFactory.putScore(r)})))},t.prototype.updateTimeCount=function(){var e=Math.floor(i.Game.getGameTime());if(!(e>5)){var t=this.TimeLabel.node.getChildByName("font").getComponent(cc.Sprite),o=this.TimeFont.getSpriteFrame("bg_time"+e);t.spriteFrame!=o&&(c.gEventMgr.emit(p.GlobalEvent.PLAY_EFFECT,"count"),t.spriteFrame=o,t.node.runAction(cc.sequence(cc.fadeTo(.2,255),cc.scaleTo(.1,1.2),cc.delayTime(.5),cc.scaleTo(.1,1),cc.fadeTo(.1,0))))}},t.prototype.update=function(e){i.Game.isStart&&(this.Guide.node.active||(i.Game.addGameTime(-e),this.TimeLabel.string=CMath.TimeFormat(i.Game.getGameTime()),30==Math.floor(i.Game.getGameTime())&&this.TimeLabel.node.getChildByName("noTime").opacity<=0&&(this.TimeLabel.getComponent(cc.Animation).play(),c.gEventMgr.emit(p.GlobalEvent.CHANGE_BGM,"bgm_30")),this.updateTimeCount()),this.showScore<this.score&&(this.showScore+=this.addScoreStep,this.showScore=Math.min(this.score,this.showScore),this.ScoreLabel.string=Math.floor(this.showScore).toString()))},__decorate([v(cc.Prefab)],t.prototype,"BubblePrefab",void 0),__decorate([v(cc.Prefab)],t.prototype,"PointPrefab",void 0),__decorate([v(cc.Prefab)],t.prototype,"TaskPrefab",void 0),__decorate([v(cc.Prefab)],t.prototype,"AddScorePrefab",void 0),__decorate([v(cc.SpriteAtlas)],t.prototype,"BubbleAtlas",void 0),__decorate([v(cc.SpriteFrame)],t.prototype,"SpringBack",void 0),__decorate([v(cc.SpriteFrame)],t.prototype,"SummerBack",void 0),__decorate([v(cc.SpriteFrame)],t.prototype,"AutumnBack",void 0),__decorate([v(cc.SpriteFrame)],t.prototype,"WinterBack",void 0),__decorate([v(cc.SpriteAtlas)],t.prototype,"TreasureAtlas",void 0),__decorate([v(cc.SpriteAtlas)],t.prototype,"TreasureIconAtlas",void 0),__decorate([v(d.default)],t.prototype,"Guide",void 0),__decorate([v(cc.Sprite)],t.prototype,"Background",void 0),__decorate([v(cc.Animation)],t.prototype,"Effect",void 0),__decorate([v(cc.SpriteAtlas)],t.prototype,"FontAtlas",void 0),__decorate([v(cc.SpriteAtlas)],t.prototype,"TimeFont",void 0),__decorate([v(cc.Prefab)],t.prototype,"FontPrefab",void 0),__decorate([v(cc.Node)],t.prototype,"FontRoot",void 0),__decorate([v(cc.Node)],t.prototype,"TreasureRoot",void 0),__decorate([v(cc.Node)],t.prototype,"BigTreasure",void 0),__decorate([v(cc.Node)],t.prototype,"SmallTreasure",void 0),__decorate([v(cc.SpriteAtlas)],t.prototype,"ResultTitle",void 0),__decorate([v(cc.Sprite)],t.prototype,"ResultFont",void 0),__decorate([v(cc.Node)],t.prototype,"BubbleLayer",void 0),__decorate([v(cc.Node)],t.prototype,"Shooter",void 0),__decorate([v(cc.Node)],t.prototype,"TopNode",void 0),__decorate([v(cc.Node)],t.prototype,"BulletArray",void 0),__decorate([v(cc.Node)],t.prototype,"TaskArray",void 0),__decorate([v(cc.Node)],t.prototype,"ShooterLayer",void 0),__decorate([v(cc.Label)],t.prototype,"TimeLabel",void 0),__decorate([v(cc.Label)],t.prototype,"ScoreLabel",void 0),__decorate([v(cc.Node)],t.prototype,"Help",void 0),t=__decorate([m],t)}(cc.Component);o.default=y,cc._RF.pop()},{"./Bubble":"Bubble","./Const":"Const","./Controller/AudioController":"AudioController","./Controller/EventManager":"EventManager","./Controller/EventName":"EventName","./Controller/Game":"Game","./Controller/GameFactory":"GameFactory","./Controller/StepController":"StepController","./Data/BubbleMatrix":"BubbleMatrix","./Guide":"Guide","./ResultLayer":"ResultLayer","./Utils/celerx":"celerx"}],Game:[function(e,t,o){"use strict";cc._RF.push(t,"f56074wKGJAf7tmCkTOJ+cK","Game"),Object.defineProperty(o,"__esModule",{value:!0});var a=e("../Data/BubbleMatrix"),n=e("../Const"),i=e("./GameFactory"),r=e("../BubbleMove"),l=e("./EventManager"),s=e("./EventName"),c=function(){function e(){this.BubbleLayer=null,this.TopNode=null,this.FontRoot=null,this.moveTimes=0,this.bubbleMatrix=new a.BubbleMatrix,this.score=0,this.streak=0,this.maxStreak=0,this.taskStreak=0,this.maxTaskStreak=0,this.bubbleScore={},this.bubbleClear={},this.bubbleDrop={},this.collisionIndexes=[],this.targets=[],this.clearIndex=[],this.dropIndex=[],this.fixedIndex=[],this.forceIndex=[],this.gameTime=0,this.isStart=!1,this.lastIndex=58,this._startIndex=58}return Object.defineProperty(e,"inst",{get:function(){return this.ins?this.ins:this.ins=new e},enumerable:!0,configurable:!0}),Object.defineProperty(e.prototype,"Season",{get:function(){return this.season},enumerable:!0,configurable:!0}),Object.defineProperty(e.prototype,"startIndex",{get:function(){return this._startIndex},set:function(e){this._startIndex=e,console.log(" startIndex:",this.startIndex)},enumerable:!0,configurable:!0}),e.prototype.start=function(){this.moveTimes=0,this.score=0,this.collisionIndexes.length=0,this.targets.length=0,this.clearIndex.length=0,this.dropIndex.length=0,this.forceIndex.length=0,this.gameTime=n.GameTime,this.streak=0,this.maxStreak=0,this.taskStreak=0,this.maxTaskStreak=0;for(var e=0,t=n.BubbleColors;e<t.length;e++){var o=t[e];this.bubbleClear[o]=0,this.bubbleDrop[o]=0,this.bubbleScore[o]=0}for(var a=0;a<50;a++){var i=CMath.getRandom(),r=i*n.SeasonPool.length;this.season=n.SeasonPool[Math.floor(r)],console.log(n.Season[this.season],r,i)}},e.prototype.getBubbleScore=function(){return this.bubbleScore},e.prototype.getTaskLength=function(){return this.targets.length},e.prototype.getCurTarget=function(){return 0==this.targets.length?{target:0,now:0}:this.targets[this.targets.length-1]},e.prototype.addTarget=function(e){0!=this.targets.length&&(this.targets[this.targets.length-1].now+=e,l.gEventMgr.emit(s.GlobalEvent.UPDATE_TASK))},e.prototype.pushTarget=function(e){this.streak=0,this.taskStreak=0,this.targets.push(e)},e.prototype.getCollisionIndexes=function(){return this.collisionIndexes},e.prototype.updateCollisionIndexes=function(){this.collisionIndexes.length=0;for(var e=this.bubbleMatrix.data,t=0;t<e.length;t++){if(e[t]&&e[t].bubble)this.bubbleMatrix.getNeiborMatrix(t,1).length<6&&this.collisionIndexes.push(t)}for(t=0;t<e.length;t++)if(e[t]&&e[t].bubble&&!(this.collisionIndexes.indexOf(t)>=0)){for(var o=!0,n=0,i=this.bubbleMatrix.getNeiborMatrix(t,1);n<i.length;n++){var r=i[n];if(this.collisionIndexes.indexOf(r)<0){o=!1;break}}o&&this.collisionIndexes.push(t)}for(t=this.startIndex-a.MatrixSize;t<this.startIndex-a.MatrixSize+a.UseSize;t++);console.log(this.collisionIndexes)},e.prototype.getScore=function(){return this.score},e.prototype.addScore=function(e,t,o,a){void 0===a&&(a=cc.v2(0,0)),this.score+=t,this.score=Math.max(0,this.score),this.addBubbleScore(e,t),l.gEventMgr.emit(s.GlobalEvent.ADD_SCORE,t,o,a)},e.prototype.getMatrix=function(){return this.bubbleMatrix},e.prototype.prepare=function(){this.bubbleMatrix.initBubbleData()},e.prototype.getLastI=function(){return this.bubbleMatrix.index2i(this.lastIndex)},e.prototype.addGameTime=function(e){this.gameTime+=e,this.gameTime<=0&&(this.gameTime=0,this.isStart=!1,l.gEventMgr.emit(s.GlobalEvent.GAME_OVER,n.OverType.TIME_UP))},e.prototype.checkOutOfMove=function(){for(var e=null,t=this.bubbleMatrix.data.length-1;t>=this.startIndex;t--)if(this.bubbleMatrix.data[t]&&this.bubbleMatrix.data[t].bubble&&this.bubbleMatrix.data[t].bubble.node.active){e=this.bubbleMatrix.data[t].bubble;break}if(e){var o=CMath.ConvertToNodeSpaceAR(e.node,e.node.getParent().getParent());console.log(" check out of move:",o.y),o.y<=r.DropBorder&&l.gEventMgr.emit(s.GlobalEvent.GAME_OVER,n.OverType.OUT_OF_MOVE)}},e.prototype.getGameTime=function(){return this.gameTime},e.prototype.addMoveTimes=function(e){void 0===e&&(e=1),this.moveTimes+=e},e.prototype.getMoveTimes=function(){return this.moveTimes},e.prototype.getBubble=function(e,t,o,a){return i.gFactory.getBubble(e,t,o,a)},e.prototype.checkRecurily=function(e,t){if(!(this.clearIndex.indexOf(e)>=0||e<this.startIndex)){this.clearIndex.push(e);for(var o=0,a=this.bubbleMatrix.getNeiborMatrix(e,1);o<a.length;o++){var n=a[o];if(!(n<this.startIndex)){var i=this.bubbleMatrix.data[n].bubble;i&&i.node.active&&t.Color==i.Color&&this.checkRecurily(n,t)}}}},e.prototype.addBubbleScore=function(e,t){this.bubbleScore[e]||(this.bubbleScore[e]=0),this.bubbleScore[e]+=t},e.prototype.addBubbleDrop=function(e){this.bubbleDrop[e]++},e.prototype.addBubbleClear=function(e){this.bubbleClear[e]++},e.prototype.checkBoomBubble=function(e){for(var t=0,o=e;t<o.length;t++){var n=o[t];if(this.bubbleMatrix.data[n].type==a.SpecialType.Boom){for(var i=[],r=0,l=this.bubbleMatrix.getNeiborMatrix(n,1,!1);r<l.length;r++){var s=l[r];this.clearIndex.indexOf(s)<0&&s>=this.startIndex&&(this.clearIndex.push(s),this.bubbleMatrix.data[s].type==a.SpecialType.Boom&&i.push(s))}this.checkBoomBubble(i)}}},e.prototype.checkClear=function(e,t,o){if(this.clearIndex.length=0,t.Type==a.SpecialType.Horce){console.log("\u5c0f\u9a6c\u7403"),this.clearIndex.push(e);for(var i=this.startIndex;i<this.bubbleMatrix.data.length;i++)this.bubbleMatrix.data[i]&&this.bubbleMatrix.data[i].bubble&&this.bubbleMatrix.data[i].bubble.node.active&&this.bubbleMatrix.data[i].color==o.Color&&this.clearIndex.push(i)}else this.checkRecurily(e,t);if(this.clearIndex.length<n.ClearCountLimit&&t.Type!=a.SpecialType.Horce)return this.clearIndex.length=0,void(this.streak=0);console.log(" --------------- \u68c0\u6d4b\u6d88\u9664 start---------------:",this.startIndex),console.log(this.clearIndex),console.log(" --------------- \u68c0\u6d4b\u6d88\u9664 end---------------"),this.checkBoomBubble(this.clearIndex),this.streak++,this.streak>=2&&(console.error(" streak:",this.streak),l.gEventMgr.emit(s.GlobalEvent.SHOW_STREAK,!0,this.streak)),this.maxStreak=Math.max(this.streak,this.maxStreak);var r=0;for(r=this.bubbleMatrix.data.length-1;r>=this.startIndex;r--){var c=this.bubbleMatrix.data[r];if(c&&c.color&&c.bubble&&c.bubble.node.active)break}this.lastIndex=r;for(var u=!1,h=0;h<this.clearIndex.length;h++){var p=this.clearIndex[h];if((b=this.bubbleMatrix.data[p].bubble)&&b.isDouble){u=!0,l.gEventMgr.emit(s.GlobalEvent.PLAY_EFFECT,"double_score");break}}t.Type==a.SpecialType.Horce&&(l.gEventMgr.emit(s.GlobalEvent.PLAY_EFFECT,"super_clear"),l.gEventMgr.emit(s.GlobalEvent.HORCE_CLEAR));for(var d=0;d<this.clearIndex.length;d++){var b;p=this.clearIndex[d];(b=this.bubbleMatrix.data[p].bubble)&&(u&&(b.DoubleScore=!0),b.onClear(.1*d,e),this.bubbleMatrix.data[p].bubble=null,this.bubbleMatrix.data[p].color=n.BubbleType.Blank,this.bubbleMatrix.data[p].type=a.SpecialType.Normal)}this.clearIndex.length=0,this.checkBubbleDrop(),this.addTarget(1),l.gEventMgr.emit(s.GlobalEvent.CHECK_TREASURE),this.checkAddBubble()},e.prototype.checkAddBubble=function(){for(var e=0,t=this.startIndex;t<=this.startIndex+9;t++)this.bubbleMatrix.data[t]&&this.bubbleMatrix.data[t].bubble&&this.bubbleMatrix.data[t].bubble.node.active&&e++;e<=5&&l.gEventMgr.emit(s.GlobalEvent.ADD_BUBBLE,3)},e.prototype.checkDrop=function(e){for(var t=this.bubbleMatrix.getNeiborMatrix(e,1,!1),o=0,a=t;o<a.length;o++){var n=a[o];if(this.fixedIndex.indexOf(n)>=0){this.fixedIndex=this.fixedIndex.concat(t),this.fixedIndex.push(e);break}}},e.prototype.checkBubbleDrop=function(){this.dropIndex.length=0,this.fixedIndex.length=0;for(var e=this.startIndex;e<this.startIndex+a.UseSize;e++)this.bubbleMatrix.data[e]&&this.bubbleMatrix.data[e].bubble&&this.fixedIndex.push(e);for(e=this.startIndex;e<this.bubbleMatrix.data.length;e++)e>=this.startIndex+a.UseSize&&this.bubbleMatrix.data[e]&&this.bubbleMatrix.data[e].bubble&&this.dropIndex.push(e);if(!(this.dropIndex.length<=0)){for(var t=0,o=this.dropIndex;t<o.length;t++){var i=o[t];this.checkDrop(i)}for(var r=0,l=this.fixedIndex;r<l.length;r++){i=l[r];(e=this.dropIndex.indexOf(i))>=0&&this.dropIndex.splice(e,1)}console.log(" \u68c0\u6d4b\u6389\u843d---------------"),console.log(this.dropIndex);for(var s=0,c=this.dropIndex;s<c.length;s++){i=c[s];if(this.bubbleMatrix.data[i]){var u=this.bubbleMatrix.data[i].bubble;u&&(u.move.drop(),this.bubbleMatrix.data[i].bubble=null,this.bubbleMatrix.data[i].color=n.BubbleType.Blank,this.bubbleMatrix.data[i].type=a.SpecialType.Normal)}}this.dropIndex.length=0}},e.prototype.addTaskStreak=function(e){this.taskStreak+=e,this.taskStreak=Math.max(0,this.taskStreak),console.error(" task streak:",this.taskStreak),this.maxTaskStreak=Math.max(this.maxTaskStreak,this.taskStreak)},e.prototype.getTaskStreak=function(){return this.taskStreak},e}();o.Game=c.inst,cc._RF.pop()},{"../BubbleMove":"BubbleMove","../Const":"Const","../Data/BubbleMatrix":"BubbleMatrix","./EventManager":"EventManager","./EventName":"EventName","./GameFactory":"GameFactory"}],Guide:[function(e,t,o){"use strict";cc._RF.push(t,"4d6d2YvErVK1L2MNAsgprAA","Guide"),Object.defineProperty(o,"__esModule",{value:!0});var a=cc._decorator,n=a.ccclass,i=a.property,r=function(e){function t(){var t=null!==e&&e.apply(this,arguments)||this;return t.ButtonAtlas=null,t.Next=null,t.Forward=null,t.Content=null,t.GuideView=null,t.callback=null,t}return __extends(t,e),t.prototype.onLoad=function(){this.Next.node.on(cc.Node.EventType.TOUCH_END,this.nextPage,this),this.Forward.node.on(cc.Node.EventType.TOUCH_END,this.forwardPage,this);for(var e=0,t=this.Content.children;e<t.length;e++){t[e].getChildByName("Close").on(cc.Node.EventType.TOUCH_END,this.hide,this)}},t.prototype.start=function(){},t.prototype.hide=function(){this.node.active=!1,this.callback&&this.callback()},t.prototype.show=function(e){this.node.active=!0,this.callback=e,this.GuideView.scrollToPage(0,0),this.Forward.node.active=!1,this.Next.node.getComponent(cc.Sprite).spriteFrame=this.ButtonAtlas.getSpriteFrame("btn_new")},t.prototype.nextPage=function(){if(this.GuideView.getCurrentPageIndex()>=this.GuideView.content.childrenCount-1)this.hide();else{var e=(this.GuideView.getCurrentPageIndex()+1)%this.GuideView.content.childrenCount;this.GuideView.setCurrentPageIndex(e),e>=this.GuideView.content.childrenCount-1&&(this.Next.node.getComponent(cc.Sprite).spriteFrame=this.ButtonAtlas.getSpriteFrame("new_close")),this.Forward.node.active=0!=e}},t.prototype.forwardPage=function(){if(this.GuideView.getCurrentPageIndex()<=0);else{var e=(this.GuideView.getCurrentPageIndex()-1)%this.GuideView.content.childrenCount;this.GuideView.setCurrentPageIndex(e),this.Forward.node.active=0!=e,this.Next.node.getComponent(cc.Sprite).spriteFrame=this.ButtonAtlas.getSpriteFrame("btn_new")}},__decorate([i(cc.SpriteAtlas)],t.prototype,"ButtonAtlas",void 0),__decorate([i(cc.Button)],t.prototype,"Next",void 0),__decorate([i(cc.Button)],t.prototype,"Forward",void 0),__decorate([i(cc.Node)],t.prototype,"Content",void 0),__decorate([i(cc.PageView)],t.prototype,"GuideView",void 0),t=__decorate([n],t)}(cc.Component);o.default=r,cc._RF.pop()},{}],HashMap:[function(e,t,o){"use strict";cc._RF.push(t,"834d8P+ikFOAYgMzFmudtRR","HashMap"),Object.defineProperty(o,"__esModule",{value:!0});var a=function(){function e(){this._list=new Array,this.clear()}return e.prototype.getIndexByKey=function(e){for(var t=this._list.length,o=0;o<t;o++){if(this._list[o].key==e)return o}return-1},e.prototype.keyOf=function(e){for(var t=this._list.length,o=0;o<t;o++){var a=this._list[o];if(a.value==e)return a.key}return null},Object.defineProperty(e.prototype,"keys",{get:function(){for(var e=new Array,t=0,o=this._list;t<o.length;t++){var a=o[t];a&&e.push(a.key)}return e},enumerable:!0,configurable:!0}),e.prototype.add=function(e,t){var o={key:e,value:t},a=this.getIndexByKey(e);-1!=a?this._list[a]=o:this._list.push(o)},Object.defineProperty(e.prototype,"values",{get:function(){return this._list},enumerable:!0,configurable:!0}),e.prototype.remove=function(e){var t=this.getIndexByKey(e);if(-1!=t){var o=this._list[t];return this._list.splice(t,1),o}return null},e.prototype.has=function(e){return-1!=this.getIndexByKey(e)},e.prototype.get=function(e){var t=this.getIndexByKey(e);return-1!=t?this._list[t].value:null},Object.defineProperty(e.prototype,"length",{get:function(){return this._list.length},enumerable:!0,configurable:!0}),e.prototype.sort=function(e){this._list.sort(e)},e.prototype.forEachKeyValue=function(e){for(var t=this._list.length,o=0;o<t;o++){e(this._list[o])}},e.prototype.forEach=function(e){for(var t=this._list.length,o=0;o<t;o++){var a=this._list[o];e(a.key,a.value)}},e.prototype.clear=function(){this._list=[]},e}();o.HashMap=a,cc._RF.pop()},{}],ResultLayer:[function(e,t,o){"use strict";cc._RF.push(t,"6cddevafb1BXoHh5PEsKHRP","ResultLayer"),Object.defineProperty(o,"__esModule",{value:!0});var a=e("./Controller/Game"),n=e("./Const"),i=e("./Controller/EventManager"),r=e("./Controller/EventName"),l=cc._decorator,s=l.ccclass,c=l.property,u=e("./Utils/celerx"),h=function(e){function t(){var t=null!==e&&e.apply(this,arguments)||this;return t.Result=null,t.Submit=null,t.TreasureRoot=null,t.Title=null,t.FinalScore=null,t.GameScore=null,t.Bonus=null,t.BonusScore=null,t.gameScore=0,t.showGameScore=0,t.bonus=0,t.showBonus=0,t.bonusScore=0,t.showBonusScore=0,t.totalScore=0,t.showTotalScore=0,t.scoreStep=0,t.submit=!1,t.show=!1,t.canSubmit=!1,t}return __extends(t,e),t.prototype.onLoad=function(){for(var e=this,t=0,o=this.TreasureRoot.children;t<o.length;t++){o[t].getChildByName("icon").opacity=0}var i=a.Game.getBubbleScore();console.log(i);for(var r=0,l=n.TreasurePool;r<l.length;r++){var s=l[r];i[s]&&(this.bonusScore+=i[s],this.bonus+=1)}this.totalScore=a.Game.getScore(),this.gameScore=this.totalScore-this.bonusScore,this.scoreStep=Math.max(Math.floor(Math.min(this.totalScore/100,this.gameScore/100)),10),this.Submit.scale=0,this.Result.scale=0,this.Result.runAction(cc.sequence(cc.scaleTo(.1,1.2),cc.scaleTo(.1,1),cc.callFunc(this.showScore,this))),this.Submit.on(cc.Node.EventType.TOUCH_END,function(){e.canSubmit&&(e.submit||(u.submitScore(a.Game.getScore()),e.submit=!0))},this)},t.prototype.setTexture=function(e){this.Title.spriteFrame=e},t.prototype.showScore=function(){var e=this;i.gEventMgr.emit(r.GlobalEvent.PLAY_EFFECT,"over",2),this.show=!0;for(var t=0,o=a.Game.getBubbleScore(),l=function(a){o[a]&&setTimeout(function(){e.TreasureRoot.getChildByName(a.toString()).getComponent(cc.Animation).play()},300*++t)},s=0,c=n.TreasurePool;s<c.length;s++){l(c[s])}},t.prototype.update=function(){var e=this;this.show&&(this.showGameScore<this.gameScore&&(this.showGameScore+=this.scoreStep,this.showGameScore=Math.min(this.showGameScore,this.gameScore),this.GameScore.string=this.showGameScore.toString()),this.showBonus<this.bonus&&(this.showBonus+=.1,this.showBonus=Math.min(this.showBonus,this.bonus),this.Bonus.string=Math.floor(this.showBonus).toString()),this.showBonusScore<this.bonusScore&&(this.showBonusScore+=this.scoreStep,this.showBonusScore=Math.min(this.showBonusScore,this.bonusScore),this.BonusScore.string=this.showBonusScore.toString()),this.showGameScore==this.gameScore&&this.showTotalScore<this.totalScore&&(this.showTotalScore+=this.scoreStep,this.showTotalScore=Math.min(this.totalScore,this.showTotalScore),this.FinalScore.string=this.showTotalScore.toString()),this.showTotalScore==this.totalScore&&(this.show=!1,this.Submit.runAction(cc.sequence(cc.scaleTo(.1,1.2),cc.scaleTo(.1,1),cc.callFunc(function(){e.canSubmit=!0,setTimeout(function(){e.submit||(u.submitScore(a.Game.getScore()),e.submit=!0)},3e3)},this)))))},__decorate([c(cc.Node)],t.prototype,"Result",void 0),__decorate([c(cc.Node)],t.prototype,"Submit",void 0),__decorate([c(cc.Node)],t.prototype,"TreasureRoot",void 0),__decorate([c(cc.Sprite)],t.prototype,"Title",void 0),__decorate([c(cc.Label)],t.prototype,"FinalScore",void 0),__decorate([c(cc.Label)],t.prototype,"GameScore",void 0),__decorate([c(cc.Label)],t.prototype,"Bonus",void 0),__decorate([c(cc.Label)],t.prototype,"BonusScore",void 0),t=__decorate([s],t)}(cc.Component);o.default=h,cc._RF.pop()},{"./Const":"Const","./Controller/EventManager":"EventManager","./Controller/EventName":"EventName","./Controller/Game":"Game","./Utils/celerx":"celerx"}],ShooterLayer:[function(e,t,o){"use strict";cc._RF.push(t,"a86feZkxotMl5W4gIeRr5Ex","ShooterLayer"),Object.defineProperty(o,"__esModule",{value:!0});var a=e("./Controller/EventManager"),n=e("./Controller/EventName"),i=e("./Bubble"),r=e("./BubbleMove"),l=e("./Controller/GameFactory"),s=e("./Controller/Game"),c=cc._decorator,u=c.ccclass,h=c.property,p=20,d={0:"bg_pointrainbow",1:"bg_pointblue",2:"bg_pointgreen",3:"bg_pointorange",4:"bg_pointpurple",5:"bg_pointred",6:"bg_pointyellow",7:"bg_pointhorse"},b={0:"bg_signrainbow",1:"bg_signblue",2:"bg_signgreen",3:"bg_signorange",4:"bg_signpurple",5:"bg_signred",6:"bg_signyellow",7:"bg_signhorse"},g=function(e){function t(){var t=null!==e&&e.apply(this,arguments)||this;return t.ShooterStar=null,t.Shooter=null,t.PointAtlas=null,t.Point=null,t.pointCount=p,t.isStart=!1,t}return __extends(t,e),t.prototype.onLoad=function(){this.ShooterStar.active=!1,this.Point.active=!1,this.node.on(cc.Node.EventType.TOUCH_START,this.onTouchStart,this),this.node.on(cc.Node.EventType.TOUCH_MOVE,this.onTouchMove,this),this.node.on(cc.Node.EventType.TOUCH_END,this.onTouchEnd,this),this.node.on(cc.Node.EventType.TOUCH_CANCEL,this.onTouchEnd,this)},t.prototype.start=function(){},t.prototype.updateStarPosition=function(e){var t=CMath.GetWorldPosition(this.Shooter),o=this.node.getParent().convertToNodeSpaceAR(e),a=CMath.getK(e,t);if(null===a){var n=t.y<=e.y?1:-1;this.ShooterStar.x=0,this.ShooterStar.y=o.y+150*n,this.updatePoint(a,n)}else{var i=Math.atan(a);n=t.x<=e.x?1:-1;this.ShooterStar.x=o.x+150*Math.cos(i)*n,this.ShooterStar.y=o.y+150*Math.sin(i)*n,this.updatePoint(a,n)}return e.sub(t)},t.prototype.updatePoint=function(e,t){for(;this.Point.childrenCount>this.pointCount;)l.gFactory.putPoint(this.Point.children[0]);for(;this.Point.childrenCount<this.pointCount;)this.Point.addChild(l.gFactory.getPoint());var o=this.Point.childrenCount;if(null===e)for(var a=0;a<o;a++){(s=this.Point.children[a]).x=0,s.y=60*a*t,s.opacity=255-a/o*200,s.getComponent(cc.Sprite).spriteFrame=this.PointAtlas.getSpriteFrame(d[this.Shooter.children[0].getComponent(i.default).Color])}else{var n=Math.atan(e);for(a=0;a<o;a++){var s;(s=this.Point.children[a]).opacity=255-a/o*200,s.x=60*a*Math.cos(n)*t;for(var c=-1==t?1:2;Math.abs(s.x)>r.BorderX;)s.x-=(Math.abs(s.x)-r.BorderX)*Math.pow(-1,c++)*2;s.y=60*a*Math.sin(n)*t,s.getComponent(cc.Sprite).spriteFrame=this.PointAtlas.getSpriteFrame(d[this.Shooter.children[0].getComponent(i.default).Color])}}},t.prototype.onTouchStart=function(e){this.Shooter.childrenCount<=0||(s.Game.isStart||this.isStart||(s.Game.isStart=!0,this.isStart=!0),s.Game.isStart&&(this.updateStarPosition(e.getLocation()),this.ShooterStar.active=!0,this.Point.active=!0,this.ShooterStar.getComponent(cc.Sprite).spriteFrame=this.PointAtlas.getSpriteFrame(b[this.Shooter.children[0].getComponent(i.default).Color])))},t.prototype.onTouchMove=function(e){this.Shooter.childrenCount<=0||s.Game.isStart&&(this.ShooterStar.active=!0,this.Point.active=!0,this.updateStarPosition(e.getLocation()))},t.prototype.onTouchEnd=function(e){if(!(this.Shooter.childrenCount<=0)&&s.Game.isStart){var t=this.updateStarPosition(e.getLocation());this.ShooterStar.active=!1,this.Point.active=!1,this.ShooterStar.y>=-700&&a.gEventMgr.emit(n.GlobalEvent.SHOOT,t)}},__decorate([h(cc.Node)],t.prototype,"ShooterStar",void 0),__decorate([h(cc.Node)],t.prototype,"Shooter",void 0),__decorate([h(cc.SpriteAtlas)],t.prototype,"PointAtlas",void 0),__decorate([h(cc.Node)],t.prototype,"Point",void 0),t=__decorate([u],t)}(cc.Component);o.default=g,cc._RF.pop()},{"./Bubble":"Bubble","./BubbleMove":"BubbleMove","./Controller/EventManager":"EventManager","./Controller/EventName":"EventName","./Controller/Game":"Game","./Controller/GameFactory":"GameFactory"}],StepController:[function(e,t,o){"use strict";cc._RF.push(t,"09ac2ySMaBKF6e+GcvfUxR0","StepController"),Object.defineProperty(o,"__esModule",{value:!0});var a=function(){function e(){this.totalStep=[],this.curStep=[]}return Object.defineProperty(e,"inst",{get:function(){return this._ins?this._ins:this._ins=new e},enumerable:!0,configurable:!0}),e.prototype.register=function(e,t){this.completeCallback=e,this.totalStep=t},e.prototype.nextStep=function(e){this.totalStep.indexOf(e)<0?console.error(" \u6ca1\u6709\u8fd9\u4e00\u6b65\uff1a",e):this.curStep.indexOf(e)>=0?console.warn(" \u6b65\u9aa4\u5df2\u5b8c\u6210\uff1a",e):(this.curStep.push(e),this.curStep.sort(function(e,t){return e>t?-1:1}),this.totalStep.sort(function(e,t){return e>t?-1:1}),console.log(" cur step:",this.curStep.join(",")),console.log(" total step:",this.totalStep.join(",")),this.curStep.join(",")==this.totalStep.join(",")&&(this.totalStep.length=0,this.completeCallback(),this.completeCallback=null))},e}();o.gStep=a.inst,cc._RF.pop()},{}],Treasure:[function(e,t,o){"use strict";cc._RF.push(t,"839c8WNoRJFOZY4LdvRkdlU","Treasure"),Object.defineProperty(o,"__esModule",{value:!0});var a=e("./Controller/Game"),n=e("./Const"),i=e("./Controller/EventManager"),r=e("./Controller/EventName"),l=cc._decorator,s=l.ccclass,c=(l.property,function(e){function t(){var t=null!==e&&e.apply(this,arguments)||this;return t.isCollider=!0,t}return __extends(t,e),t.prototype.onLoad=function(){var e=this;this.node.group="default",this.node.opacity=255,i.gEventMgr.on(r.GlobalEvent.CHECK_TREASURE,function(){a.Game.isStart&&e.checkCollider()},this)},t.prototype.update=function(){},t.prototype.checkCollider=function(){this.isCollider=!1;for(var e=a.Game.getMatrix(),t=a.Game.startIndex;t<e.data.length;t++)if(e.data[t]&&e.data[t].bubble&&e.data[t].bubble.node.active){var o=e.data[t].bubble;if(cc.Intersection.polygonCircle(this.getComponent(cc.PolygonCollider).points,{position:CMath.ConvertToNodeSpaceAR(o.node,this.node.getParent()),radius:o.getComponent(cc.CircleCollider).radius})){this.isCollider=!0;break}}this.isCollider||this.getTreasure()},t.prototype.getTreasure=function(){var e=this,t=CMath.ConvertToNodeSpaceAR(a.Game.TopNode.getChildByName("TreasureRoot").getChildByName(this.node.name),this.node.getParent()),o=CMath.Distance(t,this.node.position)/1500;this.enabled=!1,this.node.group="treasure",i.gEventMgr.emit(r.GlobalEvent.PLAY_EFFECT,"get_treasure"),this.node.runAction(cc.sequence(cc.delayTime(.1),cc.scaleTo(.1,1.44),cc.delayTime(.3),cc.callFunc(function(){a.Game.addScore(n.BubbleType["Treasure_"+e.node.name],parseInt(e.node.name),parseInt(e.node.name)/200*.1+1,CMath.ConvertToNodeSpaceAR(e.node,a.Game.TopNode))}),cc.scaleTo(.1,1),cc.moveTo(o,t),cc.fadeTo(.1,0),cc.callFunc(function(){i.gEventMgr.emit(r.GlobalEvent.GET_TREASURE,e.node.name),e.node.removeFromParent()})))},t=__decorate([s],t)}(cc.Component));o.default=c,cc._RF.pop()},{"./Const":"Const","./Controller/EventManager":"EventManager","./Controller/EventName":"EventName","./Controller/Game":"Game"}],celerx:[function(e,t,o){"use strict";cc._RF.push(t,"86cd8TXnY5AKqy5mkWiIwvz","celerx");var a="function"==typeof Symbol&&"symbol"==typeof Symbol.iterator?function(e){return typeof e}:function(e){return e&&"function"==typeof Symbol&&e.constructor===Symbol&&e!==Symbol.prototype?"symbol":typeof e};function n(e){for(var t=new Uint8Array(e),o=new Array,a=0,n=0,i=new Array(3),r=new Array(4),l=t.length,c=0;l--;)if(i[a++]=t[c++],3==a){for(r[0]=(252&i[0])>>2,r[1]=((3&i[0])<<4)+((240&i[1])>>4),r[2]=((15&i[1])<<2)+((192&i[2])>>6),r[3]=63&i[2],a=0;a<4;a++)o+=s.charAt(r[a]);a=0}if(a){for(n=a;n<3;n++)i[n]=0;for(r[0]=(252&i[0])>>2,r[1]=((3&i[0])<<4)+((240&i[1])>>4),r[2]=((15&i[1])<<2)+((192&i[2])>>6),r[3]=63&i[2],n=0;n<a+1;n++)o+=s.charAt(r[n]);for(;a++<3;)o+="="}return o}function i(e){var t,o,a,n,i,r,l=new Array,s=0;if(e!=(e=e.replace(/[^A-Za-z0-9\+\/\=]/g,""))&&alert("Warning! Characters outside Base64 range in input string ignored."),e.length%4)return alert("Error: Input length is not a multiple of 4 bytes."),"";for(var u=0;s<e.length;)t=c.indexOf(e.charAt(s++))<<2|(n=c.indexOf(e.charAt(s++)))>>4,o=(15&n)<<4|(i=c.indexOf(e.charAt(s++)))>>2,a=(3&i)<<6|(r=c.indexOf(e.charAt(s++))),l[u++]=t,64!=i&&(l[u++]=o),64!=r&&(l[u++]=a);return l}var r="function"==typeof Symbol&&"symbol"==a(Symbol.iterator)?function(e){return void 0===e?"undefined":a(e)}:function(e){return e&&"function"==typeof Symbol&&e.constructor===Symbol&&e!==Symbol.prototype?"symbol":void 0===e?"undefined":a(e)},l={default:void 0,call:function(e,t,o){var a="";if("function"==typeof t&&(o=t,t={}),t={data:void 0===t?null:t},"function"==typeof o){var n="dscb"+window.dscb++;window[n]=o,t._dscbstub=n}return t=JSON.stringify(t),window._dsbridge?a=_dsbridge.call(e,t):(window._dswk||-1!=navigator.userAgent.indexOf("_dsbridge"))&&(a=prompt("_dsbridge="+e,t)),JSON.parse(a||"{}").data},register:function(e,t,o){o=o?window._dsaf:window._dsf,window._dsInit||(window._dsInit=!0,setTimeout(function(){l.call("_dsb.dsinit")},0)),"object"==(void 0===t?"undefined":r(t))?o._obs[e]=t:o[e]=t},registerAsyn:function(e,t){this.register(e,t,!0)},hasNativeMethod:function(e,t){return this.call("_dsb.hasNativeMethod",{name:e,type:t||"all"})},disableJavascriptDialogBlock:function(e){this.call("_dsb.disableJavascriptDialogBlock",{disable:!1!==e})}};!function(){if(!window._dsf){var e,t={_dsf:{_obs:{}},_dsaf:{_obs:{}},dscb:0,celerx:l,close:function(){l.call("_dsb.closePage")},_handleMessageFromNative:function(e){var t=JSON.parse(e.data),o={id:e.callbackId,complete:!0},a=this._dsf[e.method],n=this._dsaf[e.method],i=function(e,a){o.data=e.apply(a,t),l.call("_dsb.returnValue",o)},r=function(e,a){t.push(function(e,t){o.data=e,o.complete=!1!==t,l.call("_dsb.returnValue",o)}),e.apply(a,t)};if(a)i(a,this._dsf);else if(n)r(n,this._dsaf);else if(!(2>(a=e.method.split(".")).length)){e=a.pop();a=a.join(".");var s=(n=(n=this._dsf._obs)[a]||{})[e];s&&"function"==typeof s?i(s,n):(s=(n=(n=this._dsaf._obs)[a]||{})[e])&&"function"==typeof s&&r(s,n)}}};for(e in t)window[e]=t[e];l.register("_hasJavascriptMethod",function(e,t){return 2>(t=e.split(".")).length?!(!_dsf[t]&&!_dsaf[t]):(e=t.pop(),t=t.join("."),(t=_dsf._obs[t]||_dsaf._obs[t])&&!!t[e])})}}();var s="ABCDEFGHIJKLMNOPQRSTUVWXYZabcdefghijklmnopqrstuvwxyz0123456789+/",c="ABCDEFGHIJKLMNOPQRSTUVWXYZabcdefghijklmnopqrstuvwxyz0123456789+/=",u={callback:function(){return""}},h={callback:function(){return""}};l.register("provideScore",function(){return u.callback()}),l.register("provideCurrentFrameData",function(){return h.callback()}),t.exports={onStateReceived:function(e){return l.register("onStateReceived",function(t){var o=i(t);return e(new Uint8Array(o))})},onCourtModeStarted:function(e){return l.register("onCourtModeStarted",e)},getMatch:function(){var e=l.call("getMatch","123");try{e=JSON.parse(e)}catch(e){}return e},showCourtModeDialog:function(){return l.call("showCourtModeDialog")},start:function(){return l.call("start")},sendState:function(e){return l.call("sendState",n(e))},draw:function(e){return l.call("draw",n(e))},win:function(e){return l.call("win",n(e))},lose:function(e){return l.call("lose",n(e))},surrender:function(e){return l.call("surrender",n(e))},applyAction:function(e,t){return l.call("applyAction",n(e),t)},getOnChainState:function(e){return l.call("getOnChainState","123",function(t){var o=i(t);return e(new Uint8Array(o))})},getOnChainActionDeadline:function(e){return l.call("getOnChainActionDeadline","123",e)},getCurrentBlockNumber:function(){return l.call("getCurrentBlockNumber","123")},finalizeOnChainGame:function(e){return l.call("finalizeOnChainGame","123",e)},submitScore:function(e){return l.call("submitScore",e)},ready:function(){return l.call("ready")},onStart:function(e){return l.register("onStart",e)},provideScore:function(e){return u={callback:e}},provideCurrentFrameData:function(e){return h={callback:e}},didTakeSnapshot:function(e){return l.call("didTakeSnapshot",e)}},cc._RF.pop()},{}]},{},["Bubble","BubbleMove","Const","AudioController","EventManager","EventName","Game","GameFactory","StepController","BubbleMatrix","GameScene","Guide","ResultLayer","ShooterLayer","Treasure","HashMap","celerx"]);